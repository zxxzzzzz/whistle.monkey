{"version":3,"file":"mock-monkey-core.esm.js","sources":["../src/utils/is.ts","../src/reserve/index.ts","../src/scope/index.ts","../src/generate/statement.ts","../src/generate/index.ts"],"sourcesContent":["import _ from 'lodash';\r\n\r\nexport function isDateString(str = '') {\r\n  if(typeof str !== 'string'){\r\n    return false\r\n  }\r\n  const [year, month, day] = str.split('-');\r\n  if (Number.isNaN(_.toNumber(year))) {\r\n    return false;\r\n  }\r\n  if (Number.isNaN(_.toNumber(month))) {\r\n    return false;\r\n  }\r\n  if (Number.isNaN(_.toNumber(day))) {\r\n    return false;\r\n  }\r\n  if (_.toNumber(month) > 12 || _.toNumber(month) < 1) {\r\n    return false;\r\n  }\r\n  if (_.toNumber(day) > 31 || _.toNumber(day) < 1) {\r\n    return false;\r\n  }\r\n  return true;\r\n}","import { Obj } from 'generate/interface';\r\nimport R from 'ramda';\r\nimport _ from 'lodash';\r\nimport {isDateString} from '../utils/is';\r\nimport dayjs from 'dayjs';\r\nimport faker from 'faker';\r\nimport isBetween from 'dayjs/plugin/isBetween';\r\ndayjs.extend(isBetween);\r\n\r\nconst additionalFunction = {} as Obj<Function>\r\nexport function addFunction(key:string,value:Function){\r\n  additionalFunction[key] = value\r\n}\r\n\r\nexport function deleteFunction(){\r\n  \r\n}\r\n\r\naddFunction('random', _.random)\r\n\r\naddFunction('fake', (strings:string[])=>{\r\n  return faker.fake(strings[0])\r\n})\r\naddFunction('bt10', ()=>{\r\n  return ()=>true\r\n})\r\n\r\naddFunction('between',(...params:any[]) => {\r\n  const [p1,p2] = params\r\n  if(isDateString(p1) && isDateString(p2)){\r\n    return (value:string)=>{\r\n      return dayjs(value).isBetween(p1,p2)\r\n    }\r\n  }\r\n  if(typeof p1 === 'number' && typeof p2 === 'number'){\r\n    return (value:number|string) => {\r\n      return value > p1 && value <= p2\r\n    }\r\n  }\r\n  return ()=>false\r\n})\r\n\r\nexport function getReserveFunc(){\r\n  return {R, _, dayjs, faker, ...additionalFunction, }\r\n}","import {Obj} from 'generate/interface';\r\n\r\nconst scope = new Map<string,any>()\r\nexport function addValue(key:string,value:any){\r\n  scope.set(key,value)\r\n}\r\nexport function deleteValue(key:string){\r\n  scope.delete(key)\r\n}\r\nexport function clearScope(){\r\n  scope.clear()\r\n}\r\nexport function addScope(tScope:Obj<any> ={}){\r\n  Object.keys(tScope).forEach(key => scope.set(key,tScope[key]))\r\n}\r\n\r\nexport function deleteScope(tScope:Obj<any> ={}){\r\n  Object.keys(tScope).forEach(key => scope.delete(key))\r\n}\r\n\r\nexport function getScopeValue(key:string){\r\n  return scope.get(key)\r\n}\r\nexport function getScope(){\r\n  return [...scope.keys()].reduce((re, key) =>({\r\n    ...re,\r\n    [key]:scope.get(key)\r\n  }),{})\r\n}","import { Obj } from '@/generate/interface';\r\nimport R from 'ramda';\r\nimport {getReserveFunc} from '../reserve';\r\nimport {getScope} from '../scope';\r\n\r\nfunction getValueByStatement({scope,reserveFunctions,statement}:{scope:Obj<any>,reserveFunctions:Obj<any>,statement:string}){\r\n  const combine = {...scope,...reserveFunctions}\r\n  try {\r\n    const func = Function(...Object.keys(combine),`return ${statement}`)\r\n    return func(...R.values(combine))\r\n  } catch (error) {\r\n    return statement\r\n  }\r\n}\r\n\r\nexport function getValue(statement:string, scope?:Obj<any>){\r\n  return getValueByStatement({scope:scope || getScope(),reserveFunctions:getReserveFunc(),statement})\r\n}","import { Obj, Body } from 'generate/interface';\r\nimport { getValue } from './statement';\r\nimport { addScope, addValue, deleteScope } from '../scope';\r\nimport R from 'ramda';\r\n\r\n// a<2>  => a\r\nfunction getPureKey(key = '') {\r\n  return key.replace(/<([\\s\\S]*)>/g, '')\r\n}\r\n\r\n// 获取asd<@random(1,3)>  这种数据定义的数组长度\r\nfunction getKeyOption(key = '') {\r\n  if (/[a-zA-Z0-9]+[<][\\s\\S]*[>]/.test(key)) {\r\n    const statement = key.slice(key.indexOf('<') + 1, -1)\r\n    const value = getValue(statement);\r\n    if (value === false) {\r\n      return { length: 0, exist: value === false ? false : true };\r\n    }\r\n    const tValue = parseInt(value, 10)\r\n    if (Number.isNaN(tValue)) {\r\n      return { length: 0, exist: true }\r\n    } else {\r\n      return { length: tValue, exist: true };\r\n    }\r\n  }\r\n  return { length: 0, exist: true }\r\n}\r\n\r\n// a:[1,2,3] 这种情况的处理\r\nfunction generateArray(list: Array<any>): any {\r\n  return list.map((elem) => {\r\n    if (Array.isArray(elem)) {\r\n      return generateArray(elem);\r\n    }\r\n    if (elem.constructor === Object) {\r\n      return generateObject(elem);\r\n    }\r\n    // 处理原始类型\r\n    return getValue(elem);\r\n  });\r\n}\r\n\r\n// 根据配置生成mock的数据\r\nfunction generateObject(result: Obj<any>) {\r\n  const keys = Object.keys(result);\r\n  return keys.reduce((re, key) => {\r\n    const value = result[key];\r\n    // tKey是去除参数的可读key   list<@number>  =>  list\r\n    const objectValue = generateByKey({ key, value });\r\n    const tKey = getPureKey(key);\r\n    // 如果生成的值是undefined,直接忽略这个字段\r\n    if (objectValue === undefined) {\r\n      return re\r\n    }\r\n    // 相同的key要合并成数组\r\n    if (!re[tKey]) {\r\n      re[tKey] = objectValue;\r\n    } else {\r\n      re[tKey] = [...[].concat(re[tKey], ...[].concat(objectValue))];\r\n    }\r\n    return re;\r\n  }, {} as Obj<any>);\r\n}\r\n\r\n// a<10>:xxx  这种情况的处理\r\n// value可能是个variable也可能是个map\r\n// 通过key的配置生成单独的obj\r\nfunction generateByKey({ key, value }: { key: string, value: any }) {\r\n  const option = getKeyOption(key);\r\n  const tKey = getPureKey(key)\r\n  // 该字段不需要\r\n  if (!option.exist) {\r\n    return undefined\r\n  }\r\n  // 不是数组，即普通对象\r\n  if (option.length === 0) {\r\n    if (value == null) {\r\n      return value\r\n    }\r\n    if (value.constructor === Object) {\r\n      return generateObject(value);\r\n    }\r\n    if (Array.isArray(value)) {\r\n      return generateArray(value);\r\n    }\r\n    const tValue = getValue(value)\r\n    addValue(tKey, tValue)\r\n    return tValue;\r\n  }\r\n  // 是数组\r\n  return R.range(0, option.length).map((index) => {\r\n    addValue('index', index);\r\n    if (value == null) {\r\n      return value\r\n    }\r\n    if (value.constructor === Object) {\r\n      return generateObject(value);\r\n    }\r\n    if (Array.isArray(value)) {\r\n      return generateArray(value);\r\n    }\r\n    const tValue = getValue(value)\r\n    addValue(tKey, tValue)\r\n    return tValue;\r\n  });\r\n}\r\n\r\n\r\n\r\nexport function generate(body: Body, scope: Obj<any> = {}) {\r\n  if (body) {\r\n    addScope(scope)\r\n    const re = generateObject(body)\r\n    deleteScope(scope)\r\n    return re\r\n  }\r\n  return undefined\r\n}\r\n\r\n\r\n\r\n"],"names":["isDateString","str","year","month","day","split","Number","isNaN","_","toNumber","dayjs","extend","isBetween","additionalFunction","addFunction","key","value","random","strings","faker","fake","params","p1","p2","getReserveFunc","R","scope","Map","addValue","set","addScope","tScope","Object","keys","forEach","deleteScope","delete","getScope","reduce","re","get","getValueByStatement","reserveFunctions","statement","combine","func","Function","values","error","getValue","getPureKey","replace","getKeyOption","test","slice","indexOf","length","exist","tValue","parseInt","generateArray","list","map","elem","Array","isArray","constructor","generateObject","result","objectValue","generateByKey","tKey","undefined","concat","option","range","index","generate","body"],"mappings":"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"}