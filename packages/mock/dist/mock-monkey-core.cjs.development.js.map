{"version":3,"file":"mock-monkey-core.cjs.development.js","sources":["../src/utils/is.ts","../src/reserve/index.ts","../src/scope/index.ts","../src/generate/statement.ts","../src/generate/index.ts"],"sourcesContent":["import _ from 'lodash';\r\n\r\nexport function isDateString(str = '') {\r\n  if(typeof str !== 'string'){\r\n    return false\r\n  }\r\n  const [year, month, day] = str.split('-');\r\n  if (Number.isNaN(_.toNumber(year))) {\r\n    return false;\r\n  }\r\n  if (Number.isNaN(_.toNumber(month))) {\r\n    return false;\r\n  }\r\n  if (Number.isNaN(_.toNumber(day))) {\r\n    return false;\r\n  }\r\n  if (_.toNumber(month) > 12 || _.toNumber(month) < 1) {\r\n    return false;\r\n  }\r\n  if (_.toNumber(day) > 31 || _.toNumber(day) < 1) {\r\n    return false;\r\n  }\r\n  return true;\r\n}","import R from 'ramda';\r\nimport _ from 'lodash';\r\nimport {isDateString} from '../utils/is';\r\nimport dayjs from 'dayjs';\r\nimport faker from 'faker';\r\nimport isBetween from 'dayjs/plugin/isBetween';\r\nimport validator from 'validator'\r\n\r\ndayjs.extend(isBetween);\r\n\r\nconst additionalFunction = new Map<string, Function>()\r\nexport function addFunction(key:string,value:Function){\r\n  additionalFunction.set(key, value)\r\n}\r\n\r\nexport function deleteFunction(key:string){\r\n  additionalFunction.delete(key)\r\n}\r\n\r\naddFunction('random', _.random)\r\n\r\naddFunction('fake', (strings:string[])=>{\r\n  return faker.fake(strings[0])\r\n})\r\n\r\naddFunction('test', (val:string)=>{\r\n  throw Error('测试 报错' + val)\r\n})\r\n\r\naddFunction('between',(...params:any[]) => {\r\n  const [p1,p2] = params\r\n  if(isDateString(p1) && isDateString(p2)){\r\n    return (value:string)=>{\r\n      return dayjs(value).isBetween(p1,p2)\r\n    }\r\n  }\r\n  if(typeof p1 === 'number' && typeof p2 === 'number'){\r\n    return (value:number|string) => {\r\n      return value > p1 && value <= p2\r\n    }\r\n  }\r\n  return ()=>false\r\n})\r\n\r\nexport function getReserveFunc(){\r\n  const addObj = [...additionalFunction.entries()].reduce((re, entry) => {\r\n    re[entry[0]] = entry[1]\r\n    return re\r\n  }, {} as {[key:string]:any})\r\n  return {R, _, dayjs, faker, v:validator, ...addObj}\r\n}","import {Obj} from 'generate/interface';\r\n\r\nconst scope = new Map<string,any>()\r\nexport function addValue(key:string,value:any){\r\n  scope.set(key,value)\r\n}\r\nexport function deleteValue(key:string){\r\n  scope.delete(key)\r\n}\r\nexport function clearScope(){\r\n  scope.clear()\r\n}\r\nexport function addScope(tScope:Obj<any> ={}){\r\n  Object.keys(tScope).forEach(key => scope.set(key,tScope[key]))\r\n}\r\n\r\nexport function deleteScope(tScope:Obj<any> ={}){\r\n  Object.keys(tScope).forEach(key => scope.delete(key))\r\n}\r\n\r\nexport function getScopeValue(key:string){\r\n  return scope.get(key)\r\n}\r\nexport function getScope(){\r\n  return [...scope.keys()].reduce((re, key) =>({\r\n    ...re,\r\n    [key]:scope.get(key)\r\n  }),{})\r\n}","import { Obj } from '@/generate/interface';\r\nimport R from 'ramda';\r\nimport {getReserveFunc} from '../reserve';\r\nimport {getScope} from '../scope';\r\n\r\nfunction getValueByStatement({scope,reserveFunctions,statement}:{scope:Obj<any>,reserveFunctions:Obj<any>,statement:string}){\r\n  const combine = {...scope,...reserveFunctions}\r\n  try {\r\n    const func = Function(...Object.keys(combine),`return ${statement}`)\r\n    return func(...R.values(combine))\r\n  } catch (error) {\r\n    return statement\r\n  }\r\n}\r\n\r\nexport function getValue(statement:string, scope?:Obj<any>){\r\n  return getValueByStatement({scope:scope || getScope(),reserveFunctions:getReserveFunc(),statement})\r\n}","import { Obj, Body } from 'generate/interface';\r\nimport { getValue } from './statement';\r\nimport { addScope, addValue, deleteScope } from '../scope';\r\nimport R from 'ramda';\r\n\r\n// a<2>  => a\r\nfunction getPureKey(key = '') {\r\n  return key.replace(/<([\\s\\S]*)>/g, '')\r\n}\r\n\r\n// 获取asd<@random(1,3)>  这种数据定义的数组长度\r\nfunction getKeyOption(key = '') {\r\n  if (/[a-zA-Z0-9]+[<][\\s\\S]*[>]/.test(key)) {\r\n    const statement = key.slice(key.indexOf('<') + 1, -1)\r\n    const value = getValue(statement);\r\n    if (value === false) {\r\n      return { length: 0, exist: value === false ? false : true };\r\n    }\r\n    const tValue = parseInt(value, 10)\r\n    if (Number.isNaN(tValue)) {\r\n      return { length: 0, exist: true }\r\n    } else {\r\n      return { length: tValue, exist: true };\r\n    }\r\n  }\r\n  return { length: 0, exist: true }\r\n}\r\n\r\n// a:[1,2,3] 这种情况的处理\r\nfunction generateArray(list: Array<any>): any {\r\n  return list.map((elem) => {\r\n    if (Array.isArray(elem)) {\r\n      return generateArray(elem);\r\n    }\r\n    if (elem.constructor === Object) {\r\n      return generateObject(elem);\r\n    }\r\n    // 处理原始类型\r\n    return getValue(elem);\r\n  });\r\n}\r\n\r\n// 根据配置生成mock的数据\r\nfunction generateObject(result: Obj<any>) {\r\n  const keys = Object.keys(result);\r\n  return keys.reduce((re, key) => {\r\n    const value = result[key];\r\n    // tKey是去除参数的可读key   list<@number>  =>  list\r\n    const objectValue = generateByKey({ key, value });\r\n    const tKey = getPureKey(key);\r\n    // 如果生成的值是undefined,直接忽略这个字段\r\n    if (objectValue === undefined) {\r\n      return re\r\n    }\r\n    // 相同的key要合并成数组\r\n    if (!re[tKey]) {\r\n      re[tKey] = objectValue;\r\n    } else {\r\n      re[tKey] = [...[].concat(re[tKey], ...[].concat(objectValue))];\r\n    }\r\n    return re;\r\n  }, {} as Obj<any>);\r\n}\r\n\r\n// a<10>:xxx  这种情况的处理\r\n// value可能是个variable也可能是个map\r\n// 通过key的配置生成单独的obj\r\nfunction generateByKey({ key, value }: { key: string, value: any }) {\r\n  const option = getKeyOption(key);\r\n  const tKey = getPureKey(key)\r\n  // 该字段不需要\r\n  if (!option.exist) {\r\n    return undefined\r\n  }\r\n  // 不是数组，即普通对象\r\n  if (option.length === 0) {\r\n    if (value == null) {\r\n      return value\r\n    }\r\n    if (value.constructor === Object) {\r\n      return generateObject(value);\r\n    }\r\n    if (Array.isArray(value)) {\r\n      return generateArray(value);\r\n    }\r\n    const tValue = getValue(value)\r\n    addValue(tKey, tValue)\r\n    return tValue;\r\n  }\r\n  // 是数组\r\n  return R.range(0, option.length).map((index) => {\r\n    addValue('index', index);\r\n    if (value == null) {\r\n      return value\r\n    }\r\n    if (value.constructor === Object) {\r\n      return generateObject(value);\r\n    }\r\n    if (Array.isArray(value)) {\r\n      return generateArray(value);\r\n    }\r\n    const tValue = getValue(value)\r\n    addValue(tKey, tValue)\r\n    return tValue;\r\n  });\r\n}\r\n\r\n\r\n\r\nexport function generate(body: Body, scope: Obj<any> = {}) {\r\n  if (body) {\r\n    addScope(scope)\r\n    const re = generateObject(body)\r\n    deleteScope(scope)\r\n    return re\r\n  }\r\n  return undefined\r\n}\r\n\r\n\r\n\r\n"],"names":["isDateString","str","year","month","day","split","Number","isNaN","_","toNumber","dayjs","extend","isBetween","additionalFunction","Map","addFunction","key","value","set","random","strings","faker","fake","val","Error","params","p1","p2","getReserveFunc","addObj","entries","reduce","re","entry","R","v","validator","scope","addValue","addScope","tScope","Object","keys","forEach","deleteScope","delete","getScope","get","getValueByStatement","reserveFunctions","statement","combine","func","Function","values","error","getValue","getPureKey","replace","getKeyOption","test","slice","indexOf","length","exist","tValue","parseInt","generateArray","list","map","elem","Array","isArray","constructor","generateObject","result","objectValue","generateByKey","tKey","undefined","concat","option","range","index","generate","body"],"mappings":";;;;;;;;;;;;;SAEgBA,aAAaC,GAAG,GAAG;AACjC,MAAG,OAAOA,GAAP,KAAe,QAAlB,EAA2B;AACzB,WAAO,KAAP;AACD;;AACD,QAAM,CAACC,IAAD,EAAOC,KAAP,EAAcC,GAAd,IAAqBH,GAAG,CAACI,KAAJ,CAAU,GAAV,CAA3B;;AACA,MAAIC,MAAM,CAACC,KAAP,CAAaC,CAAC,CAACC,QAAF,CAAWP,IAAX,CAAb,CAAJ,EAAoC;AAClC,WAAO,KAAP;AACD;;AACD,MAAII,MAAM,CAACC,KAAP,CAAaC,CAAC,CAACC,QAAF,CAAWN,KAAX,CAAb,CAAJ,EAAqC;AACnC,WAAO,KAAP;AACD;;AACD,MAAIG,MAAM,CAACC,KAAP,CAAaC,CAAC,CAACC,QAAF,CAAWL,GAAX,CAAb,CAAJ,EAAmC;AACjC,WAAO,KAAP;AACD;;AACD,MAAII,CAAC,CAACC,QAAF,CAAWN,KAAX,IAAoB,EAApB,IAA0BK,CAAC,CAACC,QAAF,CAAWN,KAAX,IAAoB,CAAlD,EAAqD;AACnD,WAAO,KAAP;AACD;;AACD,MAAIK,CAAC,CAACC,QAAF,CAAWL,GAAX,IAAkB,EAAlB,IAAwBI,CAAC,CAACC,QAAF,CAAWL,GAAX,IAAkB,CAA9C,EAAiD;AAC/C,WAAO,KAAP;AACD;;AACD,SAAO,IAAP;AACD;;ACfDM,KAAK,CAACC,MAAN,CAAaC,SAAb;AAEA,MAAMC,kBAAkB,gBAAG,IAAIC,GAAJ,EAA3B;AACA,SAAgBC,YAAYC,KAAWC;AACrCJ,EAAAA,kBAAkB,CAACK,GAAnB,CAAuBF,GAAvB,EAA4BC,KAA5B;AACD;AAED,AAIAF,WAAW,CAAC,QAAD,EAAWP,CAAC,CAACW,MAAb,CAAX;AAEAJ,WAAW,CAAC,MAAD,EAAUK,OAAD;AAClB,SAAOC,KAAK,CAACC,IAAN,CAAWF,OAAO,CAAC,CAAD,CAAlB,CAAP;AACD,CAFU,CAAX;AAIAL,WAAW,CAAC,MAAD,EAAUQ,GAAD;AAClB,QAAMC,KAAK,CAAC,UAAUD,GAAX,CAAX;AACD,CAFU,CAAX;AAIAR,WAAW,CAAC,SAAD,EAAW,CAAC,GAAGU,MAAJ;AACpB,QAAM,CAACC,EAAD,EAAIC,EAAJ,IAAUF,MAAhB;;AACA,MAAGzB,YAAY,CAAC0B,EAAD,CAAZ,IAAoB1B,YAAY,CAAC2B,EAAD,CAAnC,EAAwC;AACtC,WAAQV,KAAD;AACL,aAAOP,KAAK,CAACO,KAAD,CAAL,CAAaL,SAAb,CAAuBc,EAAvB,EAA0BC,EAA1B,CAAP;AACD,KAFD;AAGD;;AACD,MAAG,OAAOD,EAAP,KAAc,QAAd,IAA0B,OAAOC,EAAP,KAAc,QAA3C,EAAoD;AAClD,WAAQV,KAAD;AACL,aAAOA,KAAK,GAAGS,EAAR,IAAcT,KAAK,IAAIU,EAA9B;AACD,KAFD;AAGD;;AACD,SAAO,MAAI,KAAX;AACD,CAbU,CAAX;AAeA,SAAgBC;AACd,QAAMC,MAAM,GAAG,CAAC,GAAGhB,kBAAkB,CAACiB,OAAnB,EAAJ,EAAkCC,MAAlC,CAAyC,CAACC,EAAD,EAAKC,KAAL;AACtDD,IAAAA,EAAE,CAACC,KAAK,CAAC,CAAD,CAAN,CAAF,GAAeA,KAAK,CAAC,CAAD,CAApB;AACA,WAAOD,EAAP;AACD,GAHc,EAGZ,EAHY,CAAf;AAIA,SAAO;AAACE,IAAAA,CAAD;AAAI1B,IAAAA,CAAJ;AAAOE,IAAAA,KAAP;AAAcW,IAAAA,KAAd;AAAqBc,IAAAA,CAAC,EAACC,SAAvB;AAAkC,OAAGP;AAArC,GAAP;AACD;;AChDD,MAAMQ,KAAK,gBAAG,IAAIvB,GAAJ,EAAd;AACA,SAAgBwB,SAAStB,KAAWC;AAClCoB,EAAAA,KAAK,CAACnB,GAAN,CAAUF,GAAV,EAAcC,KAAd;AACD;AACD,SAMgBsB,SAASC,SAAiB;AACxCC,EAAAA,MAAM,CAACC,IAAP,CAAYF,MAAZ,EAAoBG,OAApB,CAA4B3B,GAAG,IAAIqB,KAAK,CAACnB,GAAN,CAAUF,GAAV,EAAcwB,MAAM,CAACxB,GAAD,CAApB,CAAnC;AACD;AAED,SAAgB4B,YAAYJ,SAAiB;AAC3CC,EAAAA,MAAM,CAACC,IAAP,CAAYF,MAAZ,EAAoBG,OAApB,CAA4B3B,GAAG,IAAIqB,KAAK,CAACQ,MAAN,CAAa7B,GAAb,CAAnC;AACD;AAED,SAGgB8B;AACd,SAAO,CAAC,GAAGT,KAAK,CAACK,IAAN,EAAJ,EAAkBX,MAAlB,CAAyB,CAACC,EAAD,EAAKhB,GAAL,MAAa,EAC3C,GAAGgB,EADwC;AAE3C,KAAChB,GAAD,GAAMqB,KAAK,CAACU,GAAN,CAAU/B,GAAV;AAFqC,GAAb,CAAzB,EAGJ,EAHI,CAAP;AAID;;ACvBD,SAASgC,mBAAT,CAA6B;AAACX,EAAAA,KAAD;AAAOY,EAAAA,gBAAP;AAAwBC,EAAAA;AAAxB,CAA7B;AACE,QAAMC,OAAO,GAAG,EAAC,GAAGd,KAAJ;AAAU,OAAGY;AAAb,GAAhB;;AACA,MAAI;AACF,UAAMG,IAAI,GAAGC,QAAQ,CAAC,GAAGZ,MAAM,CAACC,IAAP,CAAYS,OAAZ,CAAJ,YAAmCD,WAAnC,CAArB;AACA,WAAOE,IAAI,CAAC,GAAGlB,CAAC,CAACoB,MAAF,CAASH,OAAT,CAAJ,CAAX;AACD,GAHD,CAGE,OAAOI,KAAP,EAAc;AACd,WAAOL,SAAP;AACD;AACF;;AAED,SAAgBM,SAASN,WAAkBb;AACzC,SAAOW,mBAAmB,CAAC;AAACX,IAAAA,KAAK,EAACA,KAAK,IAAIS,QAAQ,EAAxB;AAA2BG,IAAAA,gBAAgB,EAACrB,cAAc,EAA1D;AAA6DsB,IAAAA;AAA7D,GAAD,CAA1B;AACD;;ACXD,SAASO,UAAT,CAAoBzC,GAAG,GAAG,EAA1B;AACE,SAAOA,GAAG,CAAC0C,OAAJ,CAAY,cAAZ,EAA4B,EAA5B,CAAP;AACD;;;AAGD,SAASC,YAAT,CAAsB3C,GAAG,GAAG,EAA5B;AACE,MAAI,4BAA4B4C,IAA5B,CAAiC5C,GAAjC,CAAJ,EAA2C;AACzC,UAAMkC,SAAS,GAAGlC,GAAG,CAAC6C,KAAJ,CAAU7C,GAAG,CAAC8C,OAAJ,CAAY,GAAZ,IAAmB,CAA7B,EAAgC,CAAC,CAAjC,CAAlB;AACA,UAAM7C,KAAK,GAAGuC,QAAQ,CAACN,SAAD,CAAtB;;AACA,QAAIjC,KAAK,KAAK,KAAd,EAAqB;AACnB,aAAO;AAAE8C,QAAAA,MAAM,EAAE,CAAV;AAAaC,QAAAA,KAAK,EAAE/C,KAAK,KAAK,KAAV,GAAkB,KAAlB,GAA0B;AAA9C,OAAP;AACD;;AACD,UAAMgD,MAAM,GAAGC,QAAQ,CAACjD,KAAD,EAAQ,EAAR,CAAvB;;AACA,QAAIX,MAAM,CAACC,KAAP,CAAa0D,MAAb,CAAJ,EAA0B;AACxB,aAAO;AAAEF,QAAAA,MAAM,EAAE,CAAV;AAAaC,QAAAA,KAAK,EAAE;AAApB,OAAP;AACD,KAFD,MAEO;AACL,aAAO;AAAED,QAAAA,MAAM,EAAEE,MAAV;AAAkBD,QAAAA,KAAK,EAAE;AAAzB,OAAP;AACD;AACF;;AACD,SAAO;AAAED,IAAAA,MAAM,EAAE,CAAV;AAAaC,IAAAA,KAAK,EAAE;AAApB,GAAP;AACD;;;AAGD,SAASG,aAAT,CAAuBC,IAAvB;AACE,SAAOA,IAAI,CAACC,GAAL,CAAUC,IAAD;AACd,QAAIC,KAAK,CAACC,OAAN,CAAcF,IAAd,CAAJ,EAAyB;AACvB,aAAOH,aAAa,CAACG,IAAD,CAApB;AACD;;AACD,QAAIA,IAAI,CAACG,WAAL,KAAqBhC,MAAzB,EAAiC;AAC/B,aAAOiC,cAAc,CAACJ,IAAD,CAArB;AACD;;;AAED,WAAOd,QAAQ,CAACc,IAAD,CAAf;AACD,GATM,CAAP;AAUD;;;AAGD,SAASI,cAAT,CAAwBC,MAAxB;AACE,QAAMjC,IAAI,GAAGD,MAAM,CAACC,IAAP,CAAYiC,MAAZ,CAAb;AACA,SAAOjC,IAAI,CAACX,MAAL,CAAY,CAACC,EAAD,EAAKhB,GAAL;AACjB,UAAMC,KAAK,GAAG0D,MAAM,CAAC3D,GAAD,CAApB;;AAEA,UAAM4D,WAAW,GAAGC,aAAa,CAAC;AAAE7D,MAAAA,GAAF;AAAOC,MAAAA;AAAP,KAAD,CAAjC;AACA,UAAM6D,IAAI,GAAGrB,UAAU,CAACzC,GAAD,CAAvB;;AAEA,QAAI4D,WAAW,KAAKG,SAApB,EAA+B;AAC7B,aAAO/C,EAAP;AACD;;;AAED,QAAI,CAACA,EAAE,CAAC8C,IAAD,CAAP,EAAe;AACb9C,MAAAA,EAAE,CAAC8C,IAAD,CAAF,GAAWF,WAAX;AACD,KAFD,MAEO;AACL5C,MAAAA,EAAE,CAAC8C,IAAD,CAAF,GAAW,CAAC,GAAG,GAAGE,MAAH,CAAUhD,EAAE,CAAC8C,IAAD,CAAZ,EAAoB,GAAG,GAAGE,MAAH,CAAUJ,WAAV,CAAvB,CAAJ,CAAX;AACD;;AACD,WAAO5C,EAAP;AACD,GAhBM,EAgBJ,EAhBI,CAAP;AAiBD;AAGD;AACA;;;AACA,SAAS6C,aAAT,CAAuB;AAAE7D,EAAAA,GAAF;AAAOC,EAAAA;AAAP,CAAvB;AACE,QAAMgE,MAAM,GAAGtB,YAAY,CAAC3C,GAAD,CAA3B;AACA,QAAM8D,IAAI,GAAGrB,UAAU,CAACzC,GAAD,CAAvB;;AAEA,MAAI,CAACiE,MAAM,CAACjB,KAAZ,EAAmB;AACjB,WAAOe,SAAP;AACD;;;AAED,MAAIE,MAAM,CAAClB,MAAP,KAAkB,CAAtB,EAAyB;AACvB,QAAI9C,KAAK,IAAI,IAAb,EAAmB;AACjB,aAAOA,KAAP;AACD;;AACD,QAAIA,KAAK,CAACwD,WAAN,KAAsBhC,MAA1B,EAAkC;AAChC,aAAOiC,cAAc,CAACzD,KAAD,CAArB;AACD;;AACD,QAAIsD,KAAK,CAACC,OAAN,CAAcvD,KAAd,CAAJ,EAA0B;AACxB,aAAOkD,aAAa,CAAClD,KAAD,CAApB;AACD;;AACD,UAAMgD,MAAM,GAAGT,QAAQ,CAACvC,KAAD,CAAvB;AACAqB,IAAAA,QAAQ,CAACwC,IAAD,EAAOb,MAAP,CAAR;AACA,WAAOA,MAAP;AACD;;;AAED,SAAO/B,CAAC,CAACgD,KAAF,CAAQ,CAAR,EAAWD,MAAM,CAAClB,MAAlB,EAA0BM,GAA1B,CAA+Bc,KAAD;AACnC7C,IAAAA,QAAQ,CAAC,OAAD,EAAU6C,KAAV,CAAR;;AACA,QAAIlE,KAAK,IAAI,IAAb,EAAmB;AACjB,aAAOA,KAAP;AACD;;AACD,QAAIA,KAAK,CAACwD,WAAN,KAAsBhC,MAA1B,EAAkC;AAChC,aAAOiC,cAAc,CAACzD,KAAD,CAArB;AACD;;AACD,QAAIsD,KAAK,CAACC,OAAN,CAAcvD,KAAd,CAAJ,EAA0B;AACxB,aAAOkD,aAAa,CAAClD,KAAD,CAApB;AACD;;AACD,UAAMgD,MAAM,GAAGT,QAAQ,CAACvC,KAAD,CAAvB;AACAqB,IAAAA,QAAQ,CAACwC,IAAD,EAAOb,MAAP,CAAR;AACA,WAAOA,MAAP;AACD,GAdM,CAAP;AAeD;;AAID,SAAgBmB,SAASC,MAAYhD,QAAkB;AACrD,MAAIgD,IAAJ,EAAU;AACR9C,IAAAA,QAAQ,CAACF,KAAD,CAAR;AACA,UAAML,EAAE,GAAG0C,cAAc,CAACW,IAAD,CAAzB;AACAzC,IAAAA,WAAW,CAACP,KAAD,CAAX;AACA,WAAOL,EAAP;AACD;;AACD,SAAO+C,SAAP;AACD;;;;;;"}