{"version":3,"file":"whistle.monkey.esm.js","sources":["../src/file/rule.ts","../src/file/handle/invalidYaml.ts","../src/file/handle/jsFile.ts","../src/utils/ignore.ts","../src/file/handle/ruleYaml.ts","../src/file/handle/ignore.ts","../src/file/index.ts","../src/whistleServer/rulesServer.ts","../src/whistleServer/serverHandle/cors.ts","../src/whistleServer/serverHandle/default.ts","../src/whistleServer/serverHandle/delay.ts","../src/utils/match.ts","../src/whistleServer/serverHandle/incomingParamsValid.ts","../src/whistleServer/server.ts","../src/whistleServer/ui.ts"],"sourcesContent":["import { Rule } from '@/interface/rule';\r\nimport micromatch from 'micromatch';\r\n\r\nconst store = new Map<string, Rule>()\r\n\r\nexport function addRule(key: string, rule: Rule) {\r\n  if (!rule) {\r\n    throw Error('rule不能为空')\r\n  }\r\n  if (!rule?.request?.url) {\r\n    throw Error('request的url不能为空')\r\n  }\r\n  store.set(key, rule)\r\n}\r\nexport function updateRule(key: string, rule: Rule) {\r\n  if (!rule) {\r\n    throw Error('rule不能为空')\r\n  }\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    store.set(key, { ...tempRule, ...rule })\r\n    return\r\n  }\r\n  store.set(key, rule)\r\n}\r\nexport function deleteRule(key: string) {\r\n  store.delete(key)\r\n}\r\nexport function disableRule(key: string) {\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    tempRule.disabled = true\r\n  }\r\n}\r\nexport function enableRule(key: string) {\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    tempRule.disabled = false\r\n  }\r\n}\r\nexport function getRule(key: string) {\r\n  return store.get(key)\r\n}\r\n\r\nexport function getRuleByUrl(url: string) {\r\n  const urlObj = new URL(url);\r\n  const pathNames = urlObj.pathname;\r\n  return [...store.values()].find(rule => {\r\n    return pathNames.includes(rule.request.url)\r\n  })\r\n}\r\n\r\nexport function query(queryList: string[]) {\r\n  return micromatch([...store.keys()], queryList)\r\n}\r\n\r\n","import path from 'path';\r\nimport YAML from 'js-yaml';\r\nimport fs from 'fs';\r\nimport { Rule, SharedStore } from '@/interface/rule';\r\n\r\n// 把json转换为yaml。不catch错误。\r\nfunction getValidJson(content: string, defaultRule:Partial<Rule>) {\r\n  const contentWithoutDocs = content.replace(/\\/\\/[^\\n\\r]*/g, '');\r\n  const parsed = JSON.parse(contentWithoutDocs);\r\n  // 有符合定义的结构体，就不覆盖用户之前输入了\r\n  if (parsed?.request) {\r\n    return parsed;\r\n  }\r\n  // 没有符合定义的结构体，说明试复制来的后端json对象\r\n  return {\r\n    ...defaultRule,\r\n    response: {\r\n      body: parsed,\r\n    },\r\n  };\r\n}\r\n\r\n// 处理非法的yaml格式\r\nexport async function handleInvalidYaml(store: SharedStore) {\r\n  const { _path, eventName } = store\r\n  const parsedPath = path.parse(_path);\r\n  if (!['add', 'change'].includes(eventName)) return 'next';\r\n  if (parsedPath.ext !== '.yaml') return 'next';\r\n  let parsedJSON = { request: { url: path.parse(_path).name, body: {} }, response: { body: {} } } as Partial<Rule>;\r\n  const content = fs.readFileSync(_path, { encoding: 'utf-8' });\r\n  // 文件内容为空，初始化一个模板\r\n  if (content === '') {\r\n    fs.writeFileSync(_path, YAML.dump({ ...parsedJSON }), {encoding: 'utf-8'});\r\n    return\r\n  }\r\n  try {\r\n    // 如果输入的是合法json,把他变成yaml格式\r\n    const obj = getValidJson(content, parsedJSON);\r\n    fs.writeFileSync(_path, YAML.dump(obj), { encoding: 'utf-8' });\r\n    return \r\n  } catch (error) { \r\n   \r\n  }\r\n  try {\r\n    store.rule = YAML.load(content) as Rule;\r\n    return 'next';\r\n  } catch (error) {\r\n    // 如果yaml格式化失败，发送问题到log\r\n    global.sendLog({\r\n      message: `${_path}文件有格式问题<span class=\"text-pink-500\">${error.message}</span>`,\r\n      type: 'error',\r\n      tags: ['yaml', '格式'],\r\n    });\r\n  }\r\n  return;\r\n}","import { addFunction } from '@zhangxin/mock-monkey-core';\r\nimport path from 'path';\r\nexport { getRuleByUrl, getRule } from '../rule';\r\nimport { SharedStore } from '../interface';\r\n\r\nexport async function handleJSFile(store:SharedStore) {\r\n  const { _path, eventName } = store\r\n  const parsedPath = path.parse(_path);\r\n  if (parsedPath.ext !== '.js' || !['add', 'change'].includes(eventName)) return 'next';\r\n  const i18n = {\r\n    add: '添加',\r\n    change: '更新',\r\n    unlinkDir: '',\r\n    unlink: '',\r\n    addDir: '',\r\n  };\r\n  try {\r\n    if (eventName === 'change') delete require.cache[_path];\r\n    const mod = require(_path);\r\n    Object.keys(mod).forEach(key => {\r\n      addFunction(key, mod[key]);\r\n    });\r\n    global.sendLog({\r\n      message: `${i18n[eventName]}了函数<span class=\"text-pink-500\">${_path}</span>`,\r\n      type: 'success',\r\n      tags: ['添加', '函数'],\r\n    });\r\n  } catch (error) {\r\n    global.sendLog({\r\n      message: `${i18n[eventName]}函数<span class=\"text-pink-500\">${_path}</span>失败，${error.message}`,\r\n      type: 'success',\r\n      tags: ['添加', '函数'],\r\n    });\r\n  }\r\n  return;\r\n}","import fs from 'fs';\r\nimport path from 'path';\r\nimport findup from 'findup-sync';\r\n\r\nexport function getIgnoreRules(dir: string, root: string) {\r\n  const ignoreFilePath = findup('.ignore', { cwd: dir });\r\n  let ignoreRules = [] as string[];\r\n  if (ignoreFilePath) {\r\n    ignoreRules = fs\r\n      .readFileSync(ignoreFilePath, { encoding: 'utf-8' })\r\n      .split('\\n')\r\n      .filter(text => !text.startsWith('// '))\r\n      .map(text => {\r\n        const prefixPath = `${path.parse(ignoreFilePath.replace(/[\\\\]/g, '/')).dir\r\n          }`.replace(root, '**');\r\n        return `${prefixPath}/${text.replace(/[\\s]*/g, '')}`;\r\n      });\r\n  }\r\n  return ignoreRules;\r\n}","import path from 'path';\r\nimport { addRule, deleteRule, query, disableRule, updateRule } from '../rule';\r\nimport micromatch from 'micromatch';\r\nimport { Rule, SharedStore } from '@/interface/rule';\r\nimport { getIgnoreRules } from '@/utils/ignore';\r\n\r\n\r\nexport async function handleYAMLFile(store: SharedStore) {\r\n  const { _path, eventName, root } = store\r\n  const parsedPath = path.parse(_path);\r\n  if (parsedPath.ext !== '.yaml') return 'next';\r\n  if (eventName === 'add') {\r\n    try {\r\n      addRule(_path, { ...store.rule as Rule, filePath: _path, disabled: false })\r\n      const ignoreRules = getIgnoreRules(parsedPath.dir, root);\r\n      if (micromatch.isMatch(_path, ignoreRules)) {\r\n        disableRule(_path);\r\n        global.sendLog({ message: `禁用了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'warning', tags: ['禁用'] });\r\n        return;\r\n      }\r\n      global.sendLog({ message: `添加了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['添加'] });\r\n    } catch (error) {\r\n      global.sendLog({ message: `添加模板<span class=\"text-pink-500\">${_path}</span>失败,${error.message}`, type: 'error' });\r\n    }\r\n  }\r\n  if (eventName === 'change') {\r\n    try {\r\n      updateRule(_path, store.rule as Rule);\r\n      global.sendLog({ message: `更新了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['更新'] });\r\n    } catch (error) {\r\n      global.sendLog({ message: `更新模板<span class=\"text-pink-500\">${_path}</span>失败`, type: 'error' });\r\n    }\r\n  }\r\n  if (eventName === 'unlinkDir') {\r\n    query([`${_path}/*`]).forEach(filePath => {\r\n      deleteRule(filePath);\r\n      global.sendLog({ message: `删除了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'warning', tags: ['禁用'] });\r\n    });\r\n  }\r\n  if (eventName === 'unlink') {\r\n    deleteRule(_path);\r\n    global.sendLog({ message: `删除了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['删除'] });\r\n  }\r\n  return;\r\n}","import path from 'path';\r\nimport { getRule, query, disableRule, enableRule } from '@/file/rule';\r\nimport micromatch from 'micromatch';\r\nimport { SharedStore } from '@/interface/rule';\r\nimport { getIgnoreRules } from '@/utils/ignore';\r\n\r\n\r\nexport async function handleIgnore(store: SharedStore) {\r\n  const { _path, root } = store\r\n  const parsedPath = path.parse(_path);\r\n  if (parsedPath.name === '.ignore') {\r\n    const ignoreRules = getIgnoreRules(parsedPath.dir, root);\r\n    query(['**']).forEach(filePath => {\r\n      const rule = getRule(filePath);\r\n      if (\r\n        rule?.disabled === true &&\r\n        !micromatch.isMatch(filePath, ignoreRules)\r\n      ) {\r\n        enableRule(filePath);\r\n        global.sendLog({\r\n          message: `启用了模板<span class=\"text-pink-500\">${filePath}</span>`,\r\n          type: 'success',\r\n          tags: ['启用'],\r\n        });\r\n        return;\r\n      }\r\n      if (\r\n        rule?.disabled === false &&\r\n        micromatch.isMatch(filePath, ignoreRules)\r\n      ) {\r\n        disableRule(filePath);\r\n        global.sendLog({\r\n          message: `禁用了模板<span class=\"text-pink-500\">${filePath}</span>`,\r\n          type: 'warning',\r\n          tags: ['禁用'],\r\n        });\r\n      }\r\n    });\r\n  }\r\n}","import chokidar from 'chokidar';\r\nimport fs from 'fs';\r\nexport { getRuleByUrl, getRule } from '@/file/rule';\r\nimport { SharedStore } from '@/interface/rule';\r\nimport { handleInvalidYaml } from '@/file/handle/invalidYaml';\r\nimport { handleJSFile } from '@/file/handle/jsFile';\r\nimport { handleYAMLFile } from '@/file/handle/ruleYaml';\r\nimport { handleIgnore } from '@/file/handle/ignore';\r\n\r\n\r\nlet currentWatcher: chokidar.FSWatcher;\r\nexport async function watch(watchPath: string) {\r\n  if (currentWatcher) {\r\n    await currentWatcher.close();\r\n  }\r\n  if (!fs.existsSync(watchPath)) throw Error('path not exist');\r\n  currentWatcher = chokidar.watch(watchPath).on('all', (eventName, _path) => {\r\n    queue([handleInvalidYaml, handleJSFile, handleYAMLFile, handleIgnore], {\r\n      eventName,\r\n      _path: _path.replace(/[\\\\]/g, '/'),\r\n      root: watchPath.replace(/[\\\\]/g, '/'),\r\n      content: ''\r\n    });\r\n  });\r\n}\r\n\r\nasync function queue(\r\n  funcs: ((store: SharedStore) => any)[],\r\n  params: SharedStore\r\n) {\r\n  if (!funcs.length) return;\r\n  const store: SharedStore = params;\r\n  for (const func of funcs) {\r\n    const flag = await func(store);\r\n    if (flag !== 'next') {\r\n      break;\r\n    }\r\n  }\r\n}\r\n","import Koa from 'koa';\r\nimport {getRuleByUrl} from '../file/index';\r\n\r\nexport default (server:any) => {\r\n  const app = new Koa();\r\n  app.proxy = true;\r\n  app.silent = true;\r\n  app.use((ctx) => {\r\n    const href = ctx.request.href\r\n    const rule = getRuleByUrl(href)\r\n    if(rule){\r\n      const sendStr = encodeURIComponent(rule.filePath)\r\n      ctx.body = `* monkey://${sendStr}`\r\n    } else {\r\n      ctx.body = `${href} ${href}`\r\n    }\r\n  })\r\n  server.on('request', app.callback());\r\n};\r\n","import http from 'http';\r\nimport { Request } from '@/interface/request';\r\n\r\n// 跨域设置\r\nexport function handleCors(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.OutgoingMessage\r\n) {\r\n  response.setHeader('Access-Control-Allow-Credentials', 'true');\r\n  response.setHeader(\r\n    'Access-Control-Allow-Origin',\r\n    request.headers['origin'] || ''\r\n  );\r\n  response.setHeader('Content-Type', 'application/json');\r\n  return 'next';\r\n}","import { generate } from '@zhangxin/mock-monkey-core';\r\nimport { Rule } from '@/interface/rule';\r\nimport http from 'http';\r\nimport { Request } from '@/interface/request';\r\n\r\n// 兜底方案\r\nexport function handleDefault(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.OutgoingMessage,\r\n  rule: Rule,\r\n  requestData: any\r\n) {\r\n  const filePath = decodeURIComponent(request.originalReq.ruleValue);\r\n  const body = generate(rule?.response?.body, requestData);\r\n  const url = new URL(request.url || '', `http://${request.headers.host}`);\r\n  response.end(JSON.stringify(body), 'utf-8');\r\n  global.sendLog({\r\n    type: 'success',\r\n    message: `请求<span class=\"text-purple-500\">${url.pathname}</span>命中文件<span class=\"text-pink-500\">${filePath}</span>`,\r\n    tags: ['命中'],\r\n  });\r\n}","import { generate } from '@zhangxin/mock-monkey-core';\r\nimport { Rule } from '@/interface/rule';\r\nimport http from 'http';\r\nimport { Request } from '@/interface/request';\r\n\r\n// 延迟功能\r\nexport function handleDelay(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.OutgoingMessage,\r\n  rule: Rule,\r\n  requestData: any\r\n) {\r\n  if (typeof rule?.delay === 'number') {\r\n    const body = generate(rule?.response?.body, requestData);\r\n    const url = new URL(request.url || '', `http://${request.headers.host}`);\r\n    const filePath = decodeURIComponent(request.originalReq.ruleValue);\r\n    setTimeout(() => {\r\n      response.end(JSON.stringify(body), 'utf-8');\r\n      global.sendLog({\r\n        type: 'success',\r\n        message: `请求<span class=\"text-purple-500\">${url.pathname}\r\n          </span>延迟${rule.delay}ms, 命中文件<span class=\"text-pink-500\">${filePath}</span>`,\r\n        tags: ['命中'],\r\n      });\r\n    }, rule.delay);\r\n    return;\r\n  }\r\n  return 'next';\r\n}","import { getValueByStatement } from '@zhangxin/mock-monkey-core';\r\n\r\ntype cMap = { [key: string]: any }\r\n\r\nfunction isEqual(statement: string, val: any, scope: any) {\r\n  const result = getValueByStatement(statement, scope);\r\n  if (typeof result === 'function') {\r\n    result(val);\r\n  }\r\n  return val === result;\r\n}\r\n\r\n// 根据多数接口调查，request body一般就一层结构，所以做个简单的，只遍历第一层的\r\nexport function isValid(\r\n  father: unknown,\r\n  child: unknown,\r\n  scope: unknown\r\n): boolean {\r\n  if (child == null) {\r\n    return true;\r\n  }\r\n  if (father == null) {\r\n    throw Error('入参不存在，但是却配置了入参验证, 所以请求失败');\r\n  }\r\n  Object.keys(child as cMap).forEach(key => {\r\n    const cv = (child as cMap)[key];\r\n    const fv = (father as cMap)[key];\r\n    const bo = isEqual(cv, fv, scope);\r\n    if (bo === false) {\r\n      throw Error(`入参字段 ${key} 不符合判定规则`);\r\n    }\r\n  });\r\n  return true\r\n}\r\n","import { Rule } from '@/interface/rule';\r\nimport http from 'http';\r\nimport { isValid } from '@/utils/match';\r\nimport { Request } from '@/interface/request';\r\n\r\n// 对入参的验证。\r\nexport function handleRequestDataMatch(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.ServerResponse,\r\n  rule: Rule,\r\n  requestData: any\r\n) {\r\n  try {\r\n    isValid(requestData, rule?.request?.body, requestData);\r\n  } catch (error) {\r\n    response.statusCode = 400;\r\n    response.statusMessage = error.message;\r\n    response.end(\r\n      JSON.stringify({ code: 400, message: error.message }),\r\n      'utf-8'\r\n    );\r\n    const filePath = decodeURIComponent(request.originalReq.ruleValue);\r\n    const url = new URL(request.url || '', `http://${request.headers.host}`);\r\n    global.sendLog({\r\n      type: 'error',\r\n      message: `请求<span class=\"text-purple-500\">${url.pathname}</span>命中文件<span class=\"text-pink-500\">${filePath}</span>,但是参数有问题`,\r\n      tags: ['命中','入参'],\r\n    });\r\n    return;\r\n  }\r\n  return 'next';\r\n}","import { getRule } from '@/file/rule';\r\nimport http from 'http';\r\nimport { Request } from '@/interface/request';\r\nimport {handleCors} from '@/whistleServer/serverHandle/cors';\r\nimport {handleDefault} from '@/whistleServer/serverHandle/default';\r\nimport {handleDelay} from '@/whistleServer/serverHandle/delay';\r\nimport {handleRequestDataMatch} from '@/whistleServer/serverHandle/incomingParamsValid';\r\n\r\n\r\nconst NEXT = 'next';\r\n\r\nexport default (server: http.Server) => {\r\n  server.on(\r\n    'request',\r\n    (req: http.IncomingMessage & Request, res: http.OutgoingMessage) => {\r\n      const filePath = decodeURIComponent(req.originalReq.ruleValue);\r\n      const rule = getRule(filePath);\r\n      if (filePath) {\r\n        let data = '';\r\n        req.on('data', (chunk: any) => {\r\n          data += chunk.toString('utf-8');\r\n        });\r\n        req.on('end', () => {\r\n          if (!data) {\r\n            data = '{}';\r\n          }\r\n          try {\r\n            const url = new URL(req.url || '', `http://${req.headers.host}`);\r\n            const queryData: { [key: string]: any } = {};\r\n            url.searchParams.forEach((val, key) => {\r\n              queryData[key] = val;\r\n            });\r\n            const requestData = { ...JSON.parse(data), ...queryData };\r\n            queue(\r\n              [handleCors, handleRequestDataMatch, handleDelay, handleDefault],\r\n              [req, res, rule, requestData]\r\n            );\r\n          } catch (error) {\r\n            res.setHeader('Content-Type', 'text/plain');\r\n            res.end(error.message, 'utf-8');\r\n            console.log(error);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  );\r\n};\r\n\r\nfunction queue(items: Function[], params: unknown[]) {\r\n  let isBreak = false;\r\n  items.forEach(func => {\r\n    if (!isBreak) {\r\n      isBreak = func(...params) === NEXT ? false : true;\r\n    }\r\n  });\r\n}\r\n","import Koa from 'koa';\r\nimport Router from '@koa/router';\r\n// @ts-ignore\r\nimport cors from '@koa/cors';\r\nimport { watch } from '../file/index';\r\nimport body from 'koa-body';\r\nimport send from 'koa-send';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\n// @ts-ignore\r\nimport { Server } from 'ws';\r\nimport { Log } from '../interface/log';\r\n\r\nconst app = new Koa();\r\nconst router = new Router();\r\n\r\nrouter.post('/cgi-bin/root', async ctx => {\r\n  const body = ctx.request.body;\r\n  if (!body.path) {\r\n    ctx.response.status = 500;\r\n    ctx.response.message = 'do not find property \"path\"';\r\n    return;\r\n  }\r\n  try {\r\n    const config = JSON.parse(\r\n      fs.readFileSync('./config.json', { encoding: 'utf-8' })\r\n    );\r\n    config.root = body.path;\r\n    fs.writeFileSync('./config.json', JSON.stringify(config), {\r\n      encoding: 'utf-8',\r\n    });\r\n    await watch(body.path);\r\n    ctx.response.status = 200;\r\n    ctx.response.body = JSON.stringify({ path: body.path });\r\n  } catch (error) {\r\n    ctx.response.status = 500;\r\n    ctx.response.message = error.message;\r\n  }\r\n});\r\nrouter.get('/cgi-bin/root', async ctx => {\r\n  const { root } = JSON.parse(\r\n    fs.readFileSync('./config.json', { encoding: 'utf-8' })\r\n  );\r\n  ctx.response.status = 200;\r\n  ctx.response.body = JSON.stringify({ path: root });\r\n});\r\n\r\napp.proxy = true;\r\napp.silent = true;\r\napp\r\n  .use(body())\r\n  .use(cors({ credentials: true }))\r\n  .use(router.routes())\r\n  .use(router.allowedMethods())\r\n  .use(async ctx => {\r\n    const root = path.resolve(__dirname, '../public');\r\n    const parsedPath = path.parse(ctx.path);\r\n    if (ctx.path === '/plugin.monkey/') {\r\n      await send(ctx, './index.html', { root });\r\n      return;\r\n    }\r\n    if (parsedPath.ext !== '') {\r\n      const isExist = fs.existsSync(`${root}${ctx.path}`);\r\n      if (isExist) {\r\n        await send(ctx, `.${ctx.path}`, { root });\r\n        return;\r\n      }\r\n      ctx.response.status = 500;\r\n      ctx.response.message = 'file not found';\r\n      return;\r\n    }\r\n    await send(ctx, './index.html', { root });\r\n  });\r\n\r\nlet hasInit = false;\r\nexport default (server: any) => {\r\n  if (!fs.existsSync('./config.json')) {\r\n    fs.writeFileSync('./config.json', JSON.stringify({ root: '' }), {\r\n      encoding: 'utf-8',\r\n    });\r\n  }\r\n  server.on('request', app.callback());\r\n  const wss = new Server({ port: 9999 });\r\n  wss.on('connection', async function(_ws: any) {\r\n    global.sendLog = (log: Log) => {\r\n      if(!log.date){\r\n        log.date = new Date().valueOf()\r\n      }\r\n      _ws.send(JSON.stringify(log));\r\n    };\r\n    if (!hasInit) {\r\n      const { root } = JSON.parse(\r\n        fs.readFileSync('./config.json', { encoding: 'utf-8' })\r\n      );\r\n      if (root) {\r\n        try {\r\n          await watch(root);\r\n        } catch (error) {\r\n          sendLog({\r\n            type: 'error',\r\n            message: error.message,\r\n            tags: ['路径'],\r\n          });\r\n        }\r\n        hasInit = true;\r\n      }\r\n    }\r\n  });\r\n};\r\n"],"names":["store","Map","addRule","key","rule","Error","request","url","set","updateRule","tempRule","get","deleteRule","delete","disableRule","disabled","enableRule","getRule","getRuleByUrl","urlObj","URL","pathNames","pathname","values","find","includes","query","queryList","micromatch","keys","getValidJson","content","defaultRule","contentWithoutDocs","replace","parsed","JSON","parse","response","body","handleInvalidYaml","_path","eventName","parsedPath","path","ext","parsedJSON","name","fs","readFileSync","encoding","writeFileSync","YAML","dump","obj","error","load","global","sendLog","message","type","tags","handleJSFile","i18n","add","change","unlinkDir","unlink","addDir","require","cache","mod","Object","forEach","addFunction","getIgnoreRules","dir","root","ignoreFilePath","findup","cwd","ignoreRules","split","filter","text","startsWith","map","prefixPath","handleYAMLFile","filePath","isMatch","handleIgnore","currentWatcher","watch","watchPath","close","existsSync","chokidar","on","queue","funcs","params","length","func","flag","server","app","Koa","proxy","silent","use","ctx","href","sendStr","encodeURIComponent","callback","handleCors","setHeader","headers","handleDefault","requestData","decodeURIComponent","originalReq","ruleValue","generate","host","end","stringify","handleDelay","delay","setTimeout","isEqual","statement","val","scope","result","getValueByStatement","isValid","father","child","cv","fv","bo","handleRequestDataMatch","statusCode","statusMessage","code","NEXT","req","res","data","chunk","toString","queryData","searchParams","console","log","items","isBreak","router","Router","post","status","config","cors","credentials","routes","allowedMethods","resolve","__dirname","send","isExist","hasInit","wss","Server","port","_ws","date","Date","valueOf"],"mappings":"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"}