{"version":3,"file":"whistle.monkey.cjs.production.min.js","sources":["../src/file/rule.ts","../src/file/handle/invalidYaml.ts","../src/file/handle/jsFile.ts","../src/utils/ignore.ts","../src/file/handle/ruleYaml.ts","../src/file/handle/ignore.ts","../src/file/index.ts","../src/whistleServer/server.ts","../src/utils/match.ts","../src/whistleServer/ui.ts","../src/whistleServer/rulesServer.ts"],"sourcesContent":["import { Rule } from './interface';\r\nimport micromatch from 'micromatch';\r\n\r\nconst store = new Map<string, Rule>()\r\n\r\nexport function addRule(key: string, rule: Rule) {\r\n  if (!rule) {\r\n    throw Error('rule不能为空')\r\n  }\r\n  if (!rule?.request?.url) {\r\n    throw Error('request的url不能为空')\r\n  }\r\n  store.set(key, rule)\r\n}\r\nexport function updateRule(key: string, rule: Rule) {\r\n  if (!rule) {\r\n    throw Error('rule不能为空')\r\n  }\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    store.set(key, { ...tempRule, ...rule })\r\n    return\r\n  }\r\n  store.set(key, rule)\r\n}\r\nexport function deleteRule(key: string) {\r\n  store.delete(key)\r\n}\r\nexport function disableRule(key: string) {\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    tempRule.disabled = true\r\n  }\r\n}\r\nexport function enableRule(key: string) {\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    tempRule.disabled = false\r\n  }\r\n}\r\nexport function getRule(key: string) {\r\n  return store.get(key)\r\n}\r\n\r\nexport function getRuleByUrl(url: string) {\r\n  const urlObj = new URL(url);\r\n  const pathNames = urlObj.pathname;\r\n  return [...store.values()].find(rule => {\r\n    return pathNames.includes(rule.request.url)\r\n  })\r\n}\r\n\r\nexport function query(queryList: string[]) {\r\n  return micromatch([...store.keys()], queryList)\r\n}\r\n\r\n","import path from 'path';\r\nimport YAML from 'js-yaml';\r\nimport fs from 'fs';\r\nimport { Rule, SharedStore } from '../interface';\r\n\r\n// 把json转换为yaml。不catch错误。\r\nfunction getValidJson(content: string, defaultRule:Partial<Rule>) {\r\n  const contentWithoutDocs = content.replace(/\\/\\/[^\\n\\r]*/g, '');\r\n  const parsed = JSON.parse(contentWithoutDocs);\r\n  // 有符合定义的结构体，就不覆盖用户之前输入了\r\n  if (parsed?.request) {\r\n    return parsed;\r\n  }\r\n  // 没有符合定义的结构体，说明试复制来的后端json对象\r\n  return {\r\n    ...defaultRule,\r\n    response: {\r\n      body: parsed,\r\n    },\r\n  };\r\n}\r\n\r\n// 处理非法的yaml格式\r\nexport async function handleInvalidYaml(store: SharedStore) {\r\n  const { _path, eventName } = store\r\n  console.log('cchange', eventName);\r\n  const parsedPath = path.parse(_path);\r\n  if (!['add', 'change'].includes(eventName)) return 'next';\r\n  if (parsedPath.ext !== '.yaml') return 'next';\r\n  let parsedJSON = { request: { url: path.parse(_path).name, body: {} }, response: { body: {} } } as Partial<Rule>;\r\n  const content = fs.readFileSync(_path, { encoding: 'utf-8' });\r\n  // 文件内容为空，初始化一个模板\r\n  if (content === '') {\r\n    fs.writeFileSync(_path, YAML.dump({ ...parsedJSON }), {encoding: 'utf-8'});\r\n    return;\r\n  }\r\n  try {\r\n    // 如果输入的是合法json,把他变成yaml格式\r\n    const obj = getValidJson(content, parsedJSON);\r\n    fs.writeFileSync(_path, YAML.dump(obj), { encoding: 'utf-8' });\r\n    return;\r\n  } catch (error) { \r\n   \r\n  }\r\n  try {\r\n    store.rule = YAML.load(content) as Rule;\r\n    return 'next';\r\n  } catch (error) {\r\n    // 如果yaml格式化失败，发送问题到log\r\n    global.sendLog({\r\n      message: `${_path}文件有格式问题<span class=\"text-pink-500\">${error.message}</span>`,\r\n      type: 'error',\r\n      tags: ['yaml', '格式'],\r\n    });\r\n  }\r\n  return;\r\n}","import { addFunction } from '@zhangxin/mock-monkey-core';\r\nimport path from 'path';\r\nexport { getRuleByUrl, getRule } from '../rule';\r\nimport { SharedStore } from '../interface';\r\n\r\nexport async function handleJSFile(store:SharedStore) {\r\n  const { _path, eventName } = store\r\n  const parsedPath = path.parse(_path);\r\n  if (parsedPath.ext !== '.js' || !['add', 'change'].includes(eventName)) return 'next';\r\n  const i18n = {\r\n    add: '添加',\r\n    change: '更新',\r\n    unlinkDir: '',\r\n    unlink: '',\r\n    addDir: '',\r\n  };\r\n  try {\r\n    if (eventName === 'change') delete require.cache[_path];\r\n    const mod = require(_path);\r\n    Object.keys(mod).forEach(key => {\r\n      addFunction(key, mod[key]);\r\n    });\r\n    global.sendLog({\r\n      message: `${i18n[eventName]}了函数<span class=\"text-pink-500\">${_path}</span>`,\r\n      type: 'success',\r\n      tags: ['添加', '函数'],\r\n    });\r\n  } catch (error) {\r\n    global.sendLog({\r\n      message: `${i18n[eventName]}函数<span class=\"text-pink-500\">${_path}</span>失败，${error.message}`,\r\n      type: 'success',\r\n      tags: ['添加', '函数'],\r\n    });\r\n  }\r\n  return;\r\n}","import fs from 'fs';\r\nimport path from 'path';\r\nimport findup from 'findup-sync';\r\n\r\nexport function getIgnoreRules(dir: string, root: string) {\r\n  const ignoreFilePath = findup('.ignore', { cwd: dir });\r\n  let ignoreRules = [] as string[];\r\n  if (ignoreFilePath) {\r\n    ignoreRules = fs\r\n      .readFileSync(ignoreFilePath, { encoding: 'utf-8' })\r\n      .split('\\n')\r\n      .filter(text => !text.startsWith('// '))\r\n      .map(text => {\r\n        const prefixPath = `${path.parse(ignoreFilePath.replace(/[\\\\]/g, '/')).dir\r\n          }`.replace(root, '**');\r\n        return `${prefixPath}/${text.replace(/[\\s]*/g, '')}`;\r\n      });\r\n  }\r\n  return ignoreRules;\r\n}","import path from 'path';\r\nimport { addRule, deleteRule, query, disableRule, updateRule } from '../rule';\r\nimport micromatch from 'micromatch';\r\nimport { Rule, SharedStore } from '@/file/interface';\r\nimport { getIgnoreRules } from '@/utils/ignore';\r\n\r\n\r\nexport async function handleYAMLFile(store: SharedStore) {\r\n  const { _path, eventName, root } = store\r\n  const parsedPath = path.parse(_path);\r\n  if (parsedPath.ext !== '.yaml') return 'next';\r\n  if (eventName === 'add') {\r\n    try {\r\n      addRule(_path, { ...store.rule as Rule, filePath: _path, disabled: false })\r\n      const ignoreRules = getIgnoreRules(parsedPath.dir, root);\r\n      if (micromatch.isMatch(_path, ignoreRules)) {\r\n        disableRule(_path);\r\n        global.sendLog({ message: `禁用了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'warning', tags: ['禁用'] });\r\n        return;\r\n      }\r\n      global.sendLog({ message: `添加了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['添加'] });\r\n    } catch (error) {\r\n      global.sendLog({ message: `添加模板<span class=\"text-pink-500\">${_path}</span>失败,${error.message}`, type: 'error' });\r\n    }\r\n  }\r\n  if (eventName === 'change') {\r\n    try {\r\n      updateRule(_path, store.rule as Rule);\r\n      global.sendLog({ message: `更新了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['更新'] });\r\n    } catch (error) {\r\n      global.sendLog({ message: `更新模板<span class=\"text-pink-500\">${_path}</span>失败`, type: 'error' });\r\n    }\r\n  }\r\n  if (eventName === 'unlinkDir') {\r\n    query([`${_path}/*`]).forEach(filePath => {\r\n      deleteRule(filePath);\r\n      global.sendLog({ message: `删除了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'warning', tags: ['禁用'] });\r\n    });\r\n  }\r\n  if (eventName === 'unlink') {\r\n    deleteRule(_path);\r\n    global.sendLog({ message: `删除了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['删除'] });\r\n  }\r\n  return;\r\n}","import path from 'path';\r\nimport { getRule, query, disableRule, enableRule } from '@/file/rule';\r\nimport micromatch from 'micromatch';\r\nimport { SharedStore } from '@/file/interface';\r\nimport { getIgnoreRules } from '@/utils/ignore';\r\n\r\n\r\nexport async function handleIgnore(store: SharedStore) {\r\n  const { _path, root } = store\r\n  const parsedPath = path.parse(_path);\r\n  if (parsedPath.name === '.ignore') {\r\n    const ignoreRules = getIgnoreRules(parsedPath.dir, root);\r\n    query(['**']).forEach(filePath => {\r\n      const rule = getRule(filePath);\r\n      if (\r\n        rule?.disabled === true &&\r\n        !micromatch.isMatch(filePath, ignoreRules)\r\n      ) {\r\n        enableRule(filePath);\r\n        global.sendLog({\r\n          message: `启用了模板<span class=\"text-pink-500\">${filePath}</span>`,\r\n          type: 'success',\r\n          tags: ['启用'],\r\n        });\r\n        return;\r\n      }\r\n      if (\r\n        rule?.disabled === false &&\r\n        micromatch.isMatch(filePath, ignoreRules)\r\n      ) {\r\n        disableRule(filePath);\r\n        global.sendLog({\r\n          message: `禁用了模板<span class=\"text-pink-500\">${filePath}</span>`,\r\n          type: 'warning',\r\n          tags: ['禁用'],\r\n        });\r\n      }\r\n    });\r\n  }\r\n}","import chokidar from 'chokidar';\r\nimport fs from 'fs';\r\nexport { getRuleByUrl, getRule } from '@/file/rule';\r\nimport { SharedStore } from '@/file/interface';\r\nimport { handleInvalidYaml } from '@/file/handle/invalidYaml';\r\nimport { handleJSFile } from '@/file/handle/jsFile';\r\nimport { handleYAMLFile } from '@/file/handle/ruleYaml';\r\nimport { handleIgnore } from '@/file/handle/ignore';\r\n\r\n\r\nlet currentWatcher: chokidar.FSWatcher;\r\nexport async function watch(watchPath: string) {\r\n  if (currentWatcher) {\r\n    await currentWatcher.close();\r\n  }\r\n  if (!fs.existsSync(watchPath)) throw Error('path not exist');\r\n  currentWatcher = chokidar.watch(watchPath).on('all', (eventName, _path) => {\r\n    queue([handleInvalidYaml, handleJSFile, handleYAMLFile, handleIgnore], {\r\n      eventName,\r\n      _path: _path.replace(/[\\\\]/g, '/'),\r\n      root: watchPath.replace(/[\\\\]/g, '/'),\r\n      content: ''\r\n    });\r\n  });\r\n}\r\n\r\nasync function queue(\r\n  funcs: ((store: SharedStore) => any)[],\r\n  params: SharedStore\r\n) {\r\n  if (!funcs.length) return;\r\n  const store: SharedStore = params;\r\n  for (const func of funcs) {\r\n    const flag = await func(store);\r\n    if (flag !== 'next') {\r\n      break;\r\n    }\r\n  }\r\n}\r\n","import { getRule } from '../file/index';\r\nimport { generate } from '@zhangxin/mock-monkey-core';\r\nimport { Rule } from '../file/interface';\r\nimport http from 'http';\r\nimport { isValid } from '../utils/match';\r\n\r\ninterface Request {\r\n  originalReq: {\r\n    ruleValue: string;\r\n  };\r\n  passThrough: () => {};\r\n}\r\n\r\nconst NEXT = 'next';\r\n\r\nexport default (server: http.Server) => {\r\n  server.on(\r\n    'request',\r\n    (req: http.IncomingMessage & Request, res: http.OutgoingMessage) => {\r\n      const filePath = decodeURIComponent(req.originalReq.ruleValue);\r\n      const rule = getRule(filePath);\r\n      if (filePath) {\r\n        let data = '';\r\n        req.on('data', (chunk: any) => {\r\n          data += chunk.toString('utf-8');\r\n        });\r\n        req.on('end', () => {\r\n          if (!data) {\r\n            data = '{}';\r\n          }\r\n          try {\r\n            const url = new URL(req.url || '', `http://${req.headers.host}`);\r\n            const queryData: { [key: string]: any } = {};\r\n            url.searchParams.forEach((val, key) => {\r\n              queryData[key] = val;\r\n            });\r\n            const requestData = { ...JSON.parse(data), ...queryData };\r\n            queue(\r\n              [handleCors, handleRequestDataMatch, handleDelay, handleDefault],\r\n              [req, res, rule, requestData]\r\n            );\r\n          } catch (error) {\r\n            res.setHeader('Content-Type', 'text/plain');\r\n            res.end(error.message, 'utf-8');\r\n            console.log(error);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  );\r\n};\r\n\r\n// 延迟功能\r\nfunction handleDelay(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.OutgoingMessage,\r\n  rule: Rule,\r\n  requestData: any\r\n) {\r\n  if (typeof rule?.delay === 'number') {\r\n    const body = generate(rule?.response?.body, requestData);\r\n    const url = new URL(request.url || '', `http://${request.headers.host}`);\r\n    const filePath = decodeURIComponent(request.originalReq.ruleValue);\r\n    setTimeout(() => {\r\n      response.end(JSON.stringify(body), 'utf-8');\r\n      global.sendLog({\r\n        type: 'success',\r\n        message: `请求<span class=\"text-purple-500\">${url.pathname}\r\n          </span>延迟${rule.delay}ms, 命中文件<span class=\"text-pink-500\">${filePath}</span>`,\r\n        tags: ['命中'],\r\n      });\r\n    }, rule.delay);\r\n    return;\r\n  }\r\n  return NEXT;\r\n}\r\n\r\n// 跨域设置\r\nfunction handleCors(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.OutgoingMessage\r\n) {\r\n  response.setHeader('Access-Control-Allow-Credentials', 'true');\r\n  response.setHeader(\r\n    'Access-Control-Allow-Origin',\r\n    request.headers['origin'] || ''\r\n  );\r\n  response.setHeader('Content-Type', 'application/json');\r\n  return NEXT;\r\n}\r\n\r\n// 对入参的验证。\r\nfunction handleRequestDataMatch(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.ServerResponse,\r\n  rule: Rule,\r\n  requestData: any\r\n) {\r\n  try {\r\n    isValid(requestData, rule?.request?.body, requestData);\r\n  } catch (error) {\r\n    response.statusCode = 400;\r\n    response.statusMessage = error.message;\r\n    response.end(\r\n      JSON.stringify({ code: 400, message: error.message }),\r\n      'utf-8'\r\n    );\r\n    const filePath = decodeURIComponent(request.originalReq.ruleValue);\r\n    const url = new URL(request.url || '', `http://${request.headers.host}`);\r\n    global.sendLog({\r\n      type: 'error',\r\n      message: `请求<span class=\"text-purple-500\">${url.pathname}</span>命中文件<span class=\"text-pink-500\">${filePath}</span>,但是参数有问题`,\r\n      tags: ['命中','入参'],\r\n    });\r\n    return;\r\n  }\r\n  return NEXT;\r\n}\r\n// 兜底方案\r\nfunction handleDefault(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.OutgoingMessage,\r\n  rule: Rule,\r\n  requestData: any\r\n) {\r\n  const filePath = decodeURIComponent(request.originalReq.ruleValue);\r\n  const body = generate(rule?.response?.body, requestData);\r\n  const url = new URL(request.url || '', `http://${request.headers.host}`);\r\n  response.end(JSON.stringify(body), 'utf-8');\r\n  global.sendLog({\r\n    type: 'success',\r\n    message: `请求<span class=\"text-purple-500\">${url.pathname}</span>命中文件<span class=\"text-pink-500\">${filePath}</span>`,\r\n    tags: ['命中'],\r\n  });\r\n}\r\n\r\nfunction queue(items: Function[], params: unknown[]) {\r\n  let isBreak = false;\r\n  items.forEach(func => {\r\n    if (!isBreak) {\r\n      isBreak = func(...params) === NEXT ? false : true;\r\n    }\r\n  });\r\n}\r\n","import { getValueByStatement } from '@zhangxin/mock-monkey-core';\r\n\r\nfunction isEqual(statement: string, val: any, scope: any) {\r\n  const result = getValueByStatement(statement, scope);\r\n  if (typeof result === 'function') {\r\n    result(val);\r\n  }\r\n  return val === result;\r\n}\r\n\r\n// 根据多数接口调查，request body一般就一层结构，所以做个简单的，只遍历第一层的\r\nexport function isValid(\r\n  father: unknown,\r\n  child: unknown,\r\n  scope: unknown\r\n): boolean {\r\n  if (child == null) {\r\n    return true;\r\n  }\r\n  if (father == null) {\r\n    throw Error('入参不存在，但是却配置了入参验证, 所以请求失败');\r\n  }\r\n  Object.keys(child as { [key: string]: any }).forEach(key => {\r\n    const cv = (child as { [key: string]: any })[key];\r\n    const fv = (father as { [key: string]: any })[key];\r\n    const bo = isEqual(cv, fv, scope);\r\n    if (bo === false) {\r\n      throw Error(`入参字段 ${key} 不符合判定规则`);\r\n    }\r\n  });\r\n  return true\r\n}\r\n","import Koa from 'koa';\r\nimport Router from '@koa/router';\r\n// @ts-ignore\r\nimport cors from '@koa/cors';\r\nimport { watch } from '../file/index';\r\nimport body from 'koa-body';\r\nimport send from 'koa-send';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\n// @ts-ignore\r\nimport { Server } from 'ws';\r\nimport { Log } from '../interface/log';\r\n\r\nconst app = new Koa();\r\nconst router = new Router();\r\n\r\nrouter.post('/cgi-bin/root', async ctx => {\r\n  const body = ctx.request.body;\r\n  if (!body.path) {\r\n    ctx.response.status = 500;\r\n    ctx.response.message = 'do not find property \"path\"';\r\n    return;\r\n  }\r\n  try {\r\n    const config = JSON.parse(\r\n      fs.readFileSync('./config.json', { encoding: 'utf-8' })\r\n    );\r\n    config.root = body.path;\r\n    fs.writeFileSync('./config.json', JSON.stringify(config), {\r\n      encoding: 'utf-8',\r\n    });\r\n    await watch(body.path);\r\n    ctx.response.status = 200;\r\n    ctx.response.body = JSON.stringify({ path: body.path });\r\n  } catch (error) {\r\n    ctx.response.status = 500;\r\n    ctx.response.message = error.message;\r\n  }\r\n});\r\nrouter.get('/cgi-bin/root', async ctx => {\r\n  const { root } = JSON.parse(\r\n    fs.readFileSync('./config.json', { encoding: 'utf-8' })\r\n  );\r\n  ctx.response.status = 200;\r\n  ctx.response.body = JSON.stringify({ path: root });\r\n});\r\n\r\napp.proxy = true;\r\napp.silent = true;\r\napp\r\n  .use(body())\r\n  .use(cors({ credentials: true }))\r\n  .use(router.routes())\r\n  .use(router.allowedMethods())\r\n  .use(async ctx => {\r\n    const root = path.resolve(__dirname, '../public');\r\n    const parsedPath = path.parse(ctx.path);\r\n    if (ctx.path === '/plugin.monkey/') {\r\n      await send(ctx, './index.html', { root });\r\n      return;\r\n    }\r\n    if (parsedPath.ext !== '') {\r\n      const isExist = fs.existsSync(`${root}${ctx.path}`);\r\n      if (isExist) {\r\n        await send(ctx, `.${ctx.path}`, { root });\r\n        return;\r\n      }\r\n      ctx.response.status = 500;\r\n      ctx.response.message = 'file not found';\r\n      return;\r\n    }\r\n    await send(ctx, './index.html', { root });\r\n  });\r\n\r\nlet hasInit = false;\r\nexport default (server: any) => {\r\n  if (!fs.existsSync('./config.json')) {\r\n    fs.writeFileSync('./config.json', JSON.stringify({ root: '' }), {\r\n      encoding: 'utf-8',\r\n    });\r\n  }\r\n  server.on('request', app.callback());\r\n  const wss = new Server({ port: 9999 });\r\n  wss.on('connection', async function(_ws: any) {\r\n    global.sendLog = (log: Log) => {\r\n      if(!log.date){\r\n        log.date = new Date().valueOf()\r\n      }\r\n      _ws.send(JSON.stringify(log));\r\n    };\r\n    if (!hasInit) {\r\n      const { root } = JSON.parse(\r\n        fs.readFileSync('./config.json', { encoding: 'utf-8' })\r\n      );\r\n      if (root) {\r\n        try {\r\n          await watch(root);\r\n        } catch (error) {\r\n          sendLog({\r\n            type: 'error',\r\n            message: error.message,\r\n            tags: ['路径'],\r\n          });\r\n        }\r\n        hasInit = true;\r\n      }\r\n    }\r\n  });\r\n};\r\n","import Koa from 'koa';\r\nimport {getRuleByUrl} from '../file/index';\r\n\r\nexport default (server:any) => {\r\n  const app = new Koa();\r\n  app.proxy = true;\r\n  app.silent = true;\r\n  app.use((ctx) => {\r\n    const href = ctx.request.href\r\n    const rule = getRuleByUrl(href)\r\n    if(rule){\r\n      const sendStr = encodeURIComponent(rule.filePath)\r\n      ctx.body = `* monkey://${sendStr}`\r\n    } else {\r\n      ctx.body = `${href} ${href}`\r\n    }\r\n  })\r\n  server.on('request', app.callback());\r\n};\r\n"],"names":["store","Map","addRule","key","rule","Error","request","_rule$request","url","set","updateRule","tempRule","get","deleteRule","delete","disableRule","disabled","enableRule","getRule","query","queryList","micromatch","keys","async","handleInvalidYaml","_path","eventName","console","log","parsedPath","path","parse","includes","ext","parsedJSON","name","body","response","content","fs","readFileSync","encoding","obj","defaultRule","contentWithoutDocs","replace","parsed","JSON","getValidJson","writeFileSync","YAML","dump","error","load","global","sendLog","message","type","tags","handleJSFile","i18n","add","change","unlinkDir","unlink","addDir","require","cache","mod","Object","forEach","addFunction","getIgnoreRules","dir","root","ignoreFilePath","findup","cwd","ignoreRules","split","filter","text","startsWith","map","handleYAMLFile","filePath","isMatch","handleIgnore","currentWatcher","watch","watchPath","close","existsSync","chokidar","on","funcs","params","length","func","queue","handleDelay","requestData","delay","generate","_rule$response","URL","headers","host","decodeURIComponent","originalReq","ruleValue","setTimeout","end","stringify","pathname","handleCors","setHeader","handleRequestDataMatch","father","child","scope","statement","val","result","getValueByStatement","isEqual","isValid","statusCode","statusMessage","code","handleDefault","_rule$response2","app","Koa","router","Router","post","ctx","status","config","proxy","silent","use","cors","credentials","routes","allowedMethods","resolve","__dirname","send","hasInit","server","href","pathNames","values","find","getRuleByUrl","sendStr","encodeURIComponent","callback","req","res","data","chunk","toString","queryData","searchParams","items","isBreak","Server","port","_ws","date","Date","valueOf"],"mappings":"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"}