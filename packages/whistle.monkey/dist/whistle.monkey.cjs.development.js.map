{"version":3,"file":"whistle.monkey.cjs.development.js","sources":["../src/file/rule.ts","../src/file/index.ts","../src/whistleServer/rulesServer.ts","../src/whistleServer/server.ts","../src/whistleServer/ui.ts"],"sourcesContent":["import { Rule } from './interface';\r\nimport micromatch from 'micromatch';\r\n\r\nconst store = new Map<string, Rule>()\r\n\r\nexport function addRule(key: string, rule: Rule) {\r\n  if (!rule) {\r\n    throw Error('rule不能为空')\r\n  }\r\n  if (!rule?.request?.url) {\r\n    throw Error('request的url不能为空')\r\n  }\r\n  store.set(key, rule)\r\n}\r\nexport function updateRule(key: string, rule: Rule) {\r\n  if (!rule) {\r\n    throw Error('rule不能为空')\r\n  }\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    store.set(key, { ...tempRule, ...rule })\r\n    return\r\n  }\r\n  store.set(key, rule)\r\n}\r\nexport function deleteRule(key: string) {\r\n  store.delete(key)\r\n}\r\nexport function disableRule(key: string) {\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    tempRule.disabled = true\r\n  }\r\n}\r\nexport function enableRule(key: string) {\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    tempRule.disabled = false\r\n  }\r\n}\r\nexport function getRule(key: string) {\r\n  return store.get(key)\r\n}\r\n\r\nexport function getRuleByUrl(url: string) {\r\n  const urlObj = new URL(url);\r\n  const pathNames = urlObj.pathname;\r\n  return [...store.values()].find(rule => {\r\n    return pathNames.includes(rule.request.url)\r\n  })\r\n}\r\n\r\nexport function query(queryList: string[]) {\r\n  return micromatch([...store.keys()], queryList)\r\n}\r\n\r\n","import chokidar from 'chokidar';\r\nimport fs from 'fs';\r\nimport YAML from 'js-yaml';\r\nimport path from 'path';\r\nimport { addRule, deleteRule, getRule, query, disableRule, enableRule } from './rule';\r\nexport { getRuleByUrl, getRule } from './rule'\r\nimport { addFunction } from '@zhangxin/mock-monkey-core';\r\nimport findup from 'findup-sync';\r\nimport micromatch from 'micromatch';\r\nimport { Rule } from './interface';\r\n\r\nlet currentWatcher: chokidar.FSWatcher\r\nexport async function watch(watchPath: string) {\r\n  if (currentWatcher) {\r\n    await currentWatcher.close()\r\n  }\r\n  if (!fs.existsSync(watchPath)) throw Error('path not exist')\r\n  currentWatcher = chokidar.watch(watchPath).on('all', (eventName, _path) => {\r\n    queue(\r\n      [handleJSFile, handleYAMLFile, handleIgnore],\r\n      [eventName, _path.replace(/[\\\\]/g, '/'), watchPath.replace(/[\\\\]/g, '/')]\r\n    )\r\n  });\r\n}\r\n\r\nfunction getObjFromYAML(filePath: string) {\r\n  let parsedJSON = {request:{url:'',body:{}},response:{body:{}}} as Partial<Rule>\r\n  try {\r\n    const content = fs.readFileSync(filePath, { encoding: 'utf-8' });\r\n    const parsedYaml = YAML.load(content) as Partial<Rule>\r\n    if (!parsedYaml) throw Error('文件内容不能为空')\r\n    // 把合法的json转换为合法yaml\r\n    if(!parsedYaml.request){\r\n      parsedJSON = formatJsonToYAML(content)\r\n      fs.writeFileSync(filePath, YAML.dump({...parsedJSON }), { encoding: 'utf-8' })\r\n      return parsedJSON\r\n    }\r\n    return parsedYaml\r\n  } catch (error) {\r\n    console.log(error);\r\n    fs.writeFileSync(filePath, YAML.dump(parsedJSON), { encoding: 'utf-8' })\r\n    return {};\r\n  }\r\n}\r\n// 把json转换为yaml。不catch错误。\r\nfunction formatJsonToYAML(content: string) {\r\n  const contentWithoutDocs = content.replace(/\\/\\/[\\s\\S]*/g, '')\r\n  console.log(contentWithoutDocs , 'contentWithoutDocs');\r\n  const parsed = JSON.parse(contentWithoutDocs)\r\n  // 有符合定义的结构体，就不覆盖用户之前输入了\r\n  if (parsed?.request) {\r\n    return {}\r\n  }\r\n  // 没有符合定义的结构体，说明试复制来的后端json对象\r\n  return {\r\n    request: { url: '',body:{} },\r\n    response: {\r\n      body: parsed\r\n    }\r\n  }\r\n}\r\n\r\nfunction addFile(filePath: string) {\r\n  addRule(filePath, { ...getObjFromYAML(filePath), filePath, disabled: false } as Rule);\r\n}\r\nfunction updateFile(filePath: string) {\r\n  addRule(filePath, getObjFromYAML(filePath) as Rule);\r\n}\r\nfunction deleteFile(filePath: string) {\r\n  deleteRule(filePath);\r\n}\r\n\r\n\r\n\r\nasync function queue(funcs: Function[], params: any[]) {\r\n  for (const func of funcs) {\r\n    await func(...params)\r\n  }\r\n}\r\n\r\nfunction getIgnoreRules(dir: string, root: string) {\r\n  const ignoreFilePath = findup('.ignore', { cwd: dir })\r\n  let ignoreRules = [] as string[]\r\n  if (ignoreFilePath) {\r\n    ignoreRules = fs.readFileSync(ignoreFilePath, { encoding: 'utf-8' })\r\n      .split('\\n')\r\n      .filter(text => !text.startsWith('// '))\r\n      .map(text => {\r\n        const prefixPath = `${path.parse(ignoreFilePath.replace(/[\\\\]/g, '/')).dir}`.replace(root, '**')\r\n        return `${prefixPath}/${text.replace(/[\\s]*/g, '')}`\r\n      })\r\n  }\r\n  return ignoreRules\r\n}\r\n\r\nasync function handleJSFile(eventName: 'add' | 'addDir' | 'change' | 'unlink' | 'unlinkDir', _path: string) {\r\n  const parsedPath = path.parse(_path)\r\n  if (parsedPath.ext === '.js' && ['add', 'change'].includes(eventName)) {\r\n    const i18n = {\r\n      add: '添加',\r\n      change: '更新',\r\n      unlinkDir: '',\r\n      unlink: '',\r\n      addDir: ''\r\n    }\r\n    try {\r\n      if (eventName === 'change') delete require.cache[_path]\r\n      const mod = require(_path)\r\n      Object.keys(mod).forEach((key) => {\r\n        addFunction(key, mod[key])\r\n      })\r\n      global.sendLog({ message: `${i18n[eventName]}了函数<span class=\"text-pink-500\">${_path}</span>`, date: new Date().valueOf(), type: 'success', tags: ['添加', '函数'] })\r\n    } catch (error) {\r\n      global.sendLog({ message: `${i18n[eventName]}函数<span class=\"text-pink-500\">${_path}</span>失败，${error.message}`, date: new Date().valueOf(), type: 'success', tags: ['添加', '函数'] })\r\n    }\r\n  }\r\n}\r\n\r\nasync function handleYAMLFile(eventName: 'add' | 'addDir' | 'change' | 'unlink' | 'unlinkDir', _path: string, root: string) {\r\n  const parsedPath = path.parse(_path)\r\n  if (parsedPath.ext !== '.yaml') return\r\n  if (eventName === 'add') {\r\n    try {\r\n      addFile(_path);\r\n      const ignoreRules = getIgnoreRules(parsedPath.dir, root)\r\n      if (micromatch.isMatch(_path, ignoreRules)) {\r\n        disableRule(_path)\r\n        global.sendLog({ message: `禁用了模板<span class=\"text-pink-500\">${_path}</span>`, date: new Date().valueOf(), type: 'warning', tags: ['禁用'] })\r\n        return\r\n      }\r\n      global.sendLog({ message: `添加了模板<span class=\"text-pink-500\">${_path}</span>`, date: new Date().valueOf(), type: 'success', tags: ['添加'] })\r\n    } catch (error) {\r\n      global.sendLog({ message: `添加模板<span class=\"text-pink-500\">${_path}</span>失败,${error.message}`, date: new Date().valueOf(), type: 'error' })\r\n    }\r\n  }\r\n  if (eventName === 'change') {\r\n    try {\r\n      updateFile(_path);\r\n      global.sendLog({ date: new Date().valueOf(), message: `更新了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['更新'] })\r\n    } catch (error) {\r\n      global.sendLog({ message: `更新模板<span class=\"text-pink-500\">${_path}</span>失败`, date: new Date().valueOf(), type: 'error' })\r\n    }\r\n  }\r\n  if (eventName === 'unlinkDir') {\r\n    query([`${_path}/*`]).forEach((filePath) => {\r\n      deleteRule(filePath)\r\n      global.sendLog({ message: `禁用了模板<span class=\"text-pink-500\">${_path}</span>`, date: new Date().valueOf(), type: 'warning', tags: ['禁用'] })\r\n    })\r\n  }\r\n  if (eventName === 'unlink') {\r\n    deleteFile(_path);\r\n    global.sendLog({ date: new Date().valueOf(), message: `删除了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['删除'] })\r\n  }\r\n}\r\n\r\nasync function handleIgnore(_eventName: 'add' | 'addDir' | 'change' | 'unlink' | 'unlinkDir', _path: string, root: string) {\r\n  const parsedPath = path.parse(_path)\r\n  if (parsedPath.name === '.ignore') {\r\n    const ignoreRules = getIgnoreRules(parsedPath.dir, root)\r\n    query(['**']).forEach((filePath) => {\r\n      const rule = getRule(filePath)\r\n      if (rule?.disabled === true && !micromatch.isMatch(filePath, ignoreRules)) {\r\n        enableRule(filePath)\r\n        global.sendLog({ message: `启用了模板<span class=\"text-pink-500\">${filePath}</span>`, date: new Date().valueOf(), type: 'success', tags: ['启用'] })\r\n        return\r\n      }\r\n      if (rule?.disabled === false && micromatch.isMatch(filePath, ignoreRules)) {\r\n        disableRule(filePath)\r\n        global.sendLog({ message: `禁用了模板<span class=\"text-pink-500\">${filePath}</span>`, date: new Date().valueOf(), type: 'warning', tags: ['禁用'] })\r\n      }\r\n    })\r\n  }\r\n}","import Koa from 'koa';\r\nimport {getRuleByUrl} from '../file/index';\r\n\r\nexport default (server:any) => {\r\n  const app = new Koa();\r\n  app.proxy = true;\r\n  app.silent = true;\r\n  app.use((ctx) => {\r\n    const href = ctx.request.href\r\n    const rule = getRuleByUrl(href)\r\n    if(rule){\r\n      const sendStr = encodeURIComponent(rule.filePath)\r\n      ctx.body = `* monkey://${sendStr}`\r\n    } else {\r\n      ctx.body = `${href} ${href}`\r\n    }\r\n  })\r\n  server.on('request', app.callback());\r\n};\r\n","import { getRule } from '../file/index';\r\nimport {generate, getValueByStatement} from '@zhangxin/mock-monkey-core';\r\n\r\nfunction isMatch(statement:string, val:any,scope:any){\r\n  const result = getValueByStatement(statement, scope)\r\n  if(typeof result === 'function'){\r\n    return result(val)\r\n  }\r\n  return val === result\r\n}\r\n\r\nexport function isContain(father: any, child: any, scope:any):boolean {\r\n  if(!child) return true\r\n  if (father === child) return true;\r\n  if(typeof child === 'string'){\r\n    return isMatch(child, father, scope)\r\n  }\r\n  if (typeof father !== 'object' || typeof child !== 'object') return false;\r\n  if(Array.isArray(father) && Array.isArray(child)) {\r\n    child.every((i) => {\r\n      if(typeof i !== 'object') return father.includes(i)\r\n      return father.some((fj) => {\r\n        isContain(fj, i, scope)\r\n      })\r\n    })\r\n  }\r\n  return Object.keys(child).every((childKey) =>{\r\n    const childItem = child[childKey]\r\n    const fatherItem = father[childKey]\r\n    if(!fatherItem) return false\r\n    return isContain(fatherItem, childItem, scope)\r\n  })\r\n}\r\n\r\nexport default (server: any) => {\r\n  server.on('request', (req: any, res: any) => {\r\n    const filePath = decodeURIComponent(req.originalReq.ruleValue);\r\n    const rule = getRule(filePath);\r\n    if (filePath) {\r\n      let data = '';\r\n      req.on('data', (chunk: any) => {\r\n        data += chunk.toString('utf-8');\r\n      });\r\n      req.on('end', () => {\r\n        if (!data) {\r\n          data = '{}';\r\n        }\r\n        try {\r\n          const url = new URL(req.url, `http://${req.headers.host}`);\r\n          const queryData: { [key: string]: any } = {};\r\n          url.searchParams.forEach((val, key) => {\r\n            queryData[key] = val;\r\n          });\r\n          const requestData = { ...JSON.parse(data), ...queryData };\r\n          const isFileMatch = isContain(requestData, rule?.request?.body, requestData);\r\n          if (!isFileMatch) {\r\n            req.passThrough();\r\n            return;\r\n          }\r\n          res.setHeader('Access-Control-Allow-Credentials', 'true');\r\n          res.setHeader('Access-Control-Allow-Origin', req.headers['origin']);\r\n          res.setHeader('Content-Type', 'application/json');\r\n          const body = generate(rule?.response?.body, requestData);\r\n          // if (typeof template.delay === 'number') {\r\n          //   setTimeout(() => {\r\n          //     res.end(JSON.stringify(body), 'utf-8');\r\n          //   }, template.delay);\r\n          //   return;\r\n          // }\r\n          res.end(JSON.stringify(body), 'utf-8');\r\n          global.sendLog({\r\n            type:'success',\r\n            message:`请求<span class=\"text-purple-500\">${url.pathname}</span>命中文件<span class=\"text-pink-500\">${filePath}</span>`,\r\n            date: new Date().valueOf(),\r\n            tags:['命中']\r\n          })\r\n        } catch (error) {\r\n          res.setHeader('Content-Type', 'text/plain');\r\n          res.end(error.message, 'utf-8');\r\n          console.log(error);\r\n        }\r\n      });\r\n    }\r\n  });\r\n};\r\n","import Koa from 'koa';\r\nimport Router from '@koa/router';\r\n// @ts-ignore\r\nimport cors from '@koa/cors';\r\nimport { watch } from '../file/index';\r\nimport body from 'koa-body';\r\nimport send from 'koa-send';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\n// @ts-ignore\r\nimport { Server } from 'ws';\r\nimport { Log } from '../interface/log';\r\n\r\nconst app = new Koa();\r\nconst router = new Router();\r\n\r\n\r\nrouter.post('/cgi-bin/root', async (ctx) => {\r\n  const body = ctx.request.body;\r\n  if (!body.path) {\r\n    ctx.response.status = 500;\r\n    ctx.response.message = 'do not find property \"path\"';\r\n    return;\r\n  }\r\n  try {\r\n    const config = JSON.parse(fs.readFileSync('./config.json', { encoding: 'utf-8' }))\r\n    config.root = body.path\r\n    fs.writeFileSync('./config.json', JSON.stringify(config), { encoding: 'utf-8' })\r\n    await watch(body.path);\r\n    ctx.response.status = 200;\r\n    ctx.response.body = JSON.stringify({ path: body.path })\r\n  } catch (error) {\r\n    ctx.response.status = 500;\r\n    ctx.response.message = error.message;\r\n  }\r\n});\r\nrouter.get('/cgi-bin/root', async (ctx) => {\r\n  const { root } = JSON.parse(fs.readFileSync('./config.json', { encoding: 'utf-8' }))\r\n  ctx.response.status = 200;\r\n  ctx.response.body = JSON.stringify({ path: root })\r\n});\r\n\r\napp.proxy = true;\r\napp.silent = true;\r\napp\r\n  .use(body())\r\n  .use(cors({ credentials: true }))\r\n  .use(router.routes())\r\n  .use(router.allowedMethods())\r\n  .use(async (ctx) => {\r\n    const root = path.resolve(__dirname, '../public')\r\n    const parsedPath = path.parse(ctx.path);\r\n    if (ctx.path === '/plugin.monkey/') {\r\n      await send(ctx, './index.html', { root });\r\n      return;\r\n    }\r\n    if (parsedPath.ext !== '') {\r\n      const isExist = fs.existsSync(`${root}${ctx.path}`);\r\n      if (isExist) {\r\n        await send(ctx, `.${ctx.path}`, { root });\r\n        return;\r\n      }\r\n      ctx.response.status = 500;\r\n      ctx.response.message = 'file not found';\r\n      return;\r\n    }\r\n    await send(ctx, './index.html', { root });\r\n  })\r\n\r\nlet hasInit = false\r\nexport default (server: any) => {\r\n  if (!fs.existsSync('./config.json')) {\r\n    fs.writeFileSync('./config.json', JSON.stringify({ root: '' }), { encoding: 'utf-8' })\r\n  }\r\n  server.on('request', app.callback());\r\n  const wss = new Server({ port: 9999 });\r\n  wss.on('connection', function (_ws: any) {\r\n    global.sendLog = (log: Log) => {\r\n      _ws.send(JSON.stringify(log))\r\n    }\r\n    if (!hasInit) {\r\n      const { root } = JSON.parse(fs.readFileSync('./config.json', { encoding: 'utf-8' }))\r\n      if (root) {\r\n        watch(root)\r\n        hasInit = true\r\n      }\r\n    }\r\n  });\r\n\r\n};\r\n"],"names":["store","Map","addRule","key","rule","Error","request","url","set","deleteRule","delete","disableRule","tempRule","get","disabled","enableRule","getRule","getRuleByUrl","urlObj","URL","pathNames","pathname","values","find","includes","query","queryList","micromatch","keys","currentWatcher","watch","watchPath","close","fs","existsSync","chokidar","on","eventName","_path","queue","handleJSFile","handleYAMLFile","handleIgnore","replace","getObjFromYAML","filePath","parsedJSON","body","response","content","readFileSync","encoding","parsedYaml","YAML","load","formatJsonToYAML","writeFileSync","dump","error","console","log","contentWithoutDocs","parsed","JSON","parse","addFile","updateFile","deleteFile","funcs","params","func","getIgnoreRules","dir","root","ignoreFilePath","findup","cwd","ignoreRules","split","filter","text","startsWith","map","prefixPath","path","parsedPath","ext","i18n","add","change","unlinkDir","unlink","addDir","require","cache","mod","Object","forEach","addFunction","global","sendLog","message","date","Date","valueOf","type","tags","isMatch","_eventName","name","server","app","Koa","proxy","silent","use","ctx","href","sendStr","encodeURIComponent","callback","statement","val","scope","result","getValueByStatement","isContain","father","child","Array","isArray","every","i","some","fj","childKey","childItem","fatherItem","req","res","decodeURIComponent","originalReq","ruleValue","data","chunk","toString","headers","host","queryData","searchParams","requestData","isFileMatch","passThrough","setHeader","generate","end","stringify","router","Router","post","status","config","cors","credentials","routes","allowedMethods","resolve","__dirname","send","isExist","hasInit","wss","Server","port","_ws"],"mappings":"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"}