{"version":3,"file":"whistle.monkey.cjs.development.js","sources":["../src/file/rule.ts","../src/file/index.ts","../src/whistleServer/rulesServer.ts","../src/utils/match.ts","../src/whistleServer/server.ts","../src/whistleServer/ui.ts"],"sourcesContent":["import { Rule } from './interface';\r\nimport micromatch from 'micromatch';\r\n\r\nconst store = new Map<string, Rule>()\r\n\r\nexport function addRule(key: string, rule: Rule) {\r\n  if (!rule) {\r\n    throw Error('rule不能为空')\r\n  }\r\n  store.set(key, rule)\r\n}\r\nexport function updateRule(key: string, rule: Rule) {\r\n  if (!rule) {\r\n    throw Error('rule不能为空')\r\n  }\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    store.set(key, { ...tempRule, ...rule })\r\n    return\r\n  }\r\n  store.set(key, rule)\r\n}\r\nexport function deleteRule(key: string) {\r\n  store.delete(key)\r\n}\r\nexport function disableRule(key: string) {\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    tempRule.disabled = true\r\n  }\r\n}\r\nexport function enableRule(key: string) {\r\n  const tempRule = store.get(key);\r\n  if (tempRule) {\r\n    tempRule.disabled = false\r\n  }\r\n}\r\nexport function getRule(key: string) {\r\n  return store.get(key)\r\n}\r\n\r\nexport function getRuleByUrl(url: string) {\r\n  const urlObj = new URL(url);\r\n  const pathNames = urlObj.pathname;\r\n  return [...store.values()].find(rule => {\r\n    return pathNames.includes(rule.request.url)\r\n  })\r\n}\r\n\r\nexport function query(queryList: string[]) {\r\n  return micromatch([...store.keys()], queryList)\r\n}\r\n\r\n","import chokidar from 'chokidar';\r\nimport fs from 'fs';\r\nimport YAML from 'yaml';\r\nimport path from 'path';\r\nimport { addRule, deleteRule, getRule, query, disableRule, enableRule } from './rule';\r\nexport { getRuleByUrl, getRule } from './rule'\r\nimport { addFunction } from '@zhangxin/mock-monkey-core';\r\nimport findup from 'findup-sync';\r\nimport micromatch from 'micromatch';\r\n\r\nlet currentWatcher: chokidar.FSWatcher\r\nexport async function watch(watchPath: string) {\r\n  if (currentWatcher) {\r\n    await currentWatcher.close()\r\n  }\r\n  if (!fs.existsSync(watchPath)) throw Error('path not exist')\r\n  currentWatcher = chokidar.watch(watchPath).on('all', (eventName, _path) => {\r\n    queue(\r\n      [handleJSFile, handleYAMLFile, handleIgnore],\r\n      [eventName, _path.replace(/[\\\\]/g, '/'), watchPath.replace(/[\\\\]/g, '/')]\r\n    )\r\n  });\r\n}\r\n\r\nfunction getObjFromYAML(filePath: string) {\r\n  try {\r\n    const content = fs.readFileSync(filePath, { encoding: 'utf-8' });\r\n    return YAML.parse(content);\r\n  } catch (error) {\r\n    return {};\r\n  }\r\n}\r\n\r\nfunction addFile(filePath: string) {\r\n  addRule(filePath, { ...getObjFromYAML(filePath), filePath, disabled: false });\r\n}\r\nfunction updateFile(filePath: string) {\r\n  addRule(filePath, getObjFromYAML(filePath));\r\n}\r\nfunction deleteFile(filePath: string) {\r\n  deleteRule(filePath);\r\n}\r\n\r\n\r\n\r\nasync function queue(funcs: Function[], params: any[]) {\r\n  for (const func of funcs) {\r\n    await func(...params)\r\n  }\r\n}\r\n\r\nfunction getIgnoreRules(dir: string, root: string) {\r\n  const ignoreFilePath = findup('.ignore', { cwd: dir })\r\n  let ignoreRules = [] as string[]\r\n  if (ignoreFilePath) {\r\n    ignoreRules = fs.readFileSync(ignoreFilePath, { encoding: 'utf-8' })\r\n      .split('\\n')\r\n      .filter(text => !text.startsWith('// '))\r\n      .map(text => {\r\n        const prefixPath = `${path.parse(ignoreFilePath.replace(/[\\\\]/g, '/')).dir}`.replace(root, '**')\r\n        return `${prefixPath}/${text.replace(/[\\s]*/g, '')}`\r\n      })\r\n  }\r\n  return ignoreRules\r\n}\r\n\r\nasync function handleJSFile(eventName: 'add' | 'addDir' | 'change' | 'unlink' | 'unlinkDir', _path: string) {\r\n  const parsedPath = path.parse(_path)\r\n  if (parsedPath.ext === '.js' && ['add', 'change'].includes(eventName)) {\r\n    const i18n = {\r\n      add: '添加',\r\n      change: '更新',\r\n      unlinkDir: '',\r\n      unlink: '',\r\n      addDir: ''\r\n    }\r\n    try {\r\n      if (eventName === 'change') delete require.cache[_path]\r\n      const mod = require(_path)\r\n      Object.keys(mod).forEach((key) => {\r\n        addFunction(key, mod[key])\r\n      })\r\n      global.sendLog({ message: `${i18n[eventName]}了函数<span class=\"text-pink-500\">${_path}</span>`, date: new Date().valueOf(), type: 'success', tags: ['添加', '函数'] })\r\n    } catch (error) {\r\n      global.sendLog({ message: `${i18n[eventName]}函数<span class=\"text-pink-500\">${_path}</span>失败，${error.message}`, date: new Date().valueOf(), type: 'success', tags: ['添加', '函数'] })\r\n    }\r\n  }\r\n}\r\n\r\nasync function handleYAMLFile(eventName: 'add' | 'addDir' | 'change' | 'unlink' | 'unlinkDir', _path: string, root: string) {\r\n  const parsedPath = path.parse(_path)\r\n  if (parsedPath.ext !== '.yaml') return\r\n  if (eventName === 'add') {\r\n    try {\r\n      addFile(_path);\r\n      const ignoreRules = getIgnoreRules(parsedPath.dir, root)\r\n      if (micromatch.isMatch(_path, ignoreRules)) {\r\n        disableRule(_path)\r\n        global.sendLog({ message: `禁用了模板<span class=\"text-pink-500\">${_path}</span>`, date: new Date().valueOf(), type: 'warning', tags: ['禁用'] })\r\n        return\r\n      }\r\n      global.sendLog({ message: `添加了模板<span class=\"text-pink-500\">${_path}</span>`, date: new Date().valueOf(), type: 'success', tags: ['添加'] })\r\n    } catch (error) {\r\n      global.sendLog({ message: `添加模板<span class=\"text-pink-500\">${_path}</span>失败,${error.message}`, date: new Date().valueOf(), type: 'error' })\r\n    }\r\n  }\r\n  if (eventName === 'change') {\r\n    try {\r\n      updateFile(_path);\r\n      global.sendLog({ date: new Date().valueOf(), message: `更新了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['更新'] })\r\n    } catch (error) {\r\n      global.sendLog({ message: `更新模板<span class=\"text-pink-500\">${_path}</span>失败`, date: new Date().valueOf(), type: 'error' })\r\n    }\r\n  }\r\n  if (eventName === 'unlinkDir') {\r\n    query([`${_path}/*`]).forEach((filePath) => {\r\n      deleteRule(filePath)\r\n      global.sendLog({ message: `禁用了模板<span class=\"text-pink-500\">${_path}</span>`, date: new Date().valueOf(), type: 'warning', tags: ['禁用'] })\r\n    })\r\n  }\r\n  if (eventName === 'unlink') {\r\n    deleteFile(_path);\r\n    global.sendLog({ date: new Date().valueOf(), message: `删除了模板<span class=\"text-pink-500\">${_path}</span>`, type: 'success', tags: ['删除'] })\r\n  }\r\n}\r\n\r\nasync function handleIgnore(_eventName: 'add' | 'addDir' | 'change' | 'unlink' | 'unlinkDir', _path: string, root: string) {\r\n  const parsedPath = path.parse(_path)\r\n  if (parsedPath.name === '.ignore') {\r\n    const ignoreRules = getIgnoreRules(parsedPath.dir, root)\r\n    query(['**']).forEach((filePath) => {\r\n      const rule = getRule(filePath)\r\n      if (rule?.disabled === true && !micromatch.isMatch(filePath, ignoreRules)) {\r\n        enableRule(filePath)\r\n        global.sendLog({ message: `启用了模板<span class=\"text-pink-500\">${filePath}</span>`, date: new Date().valueOf(), type: 'success', tags: ['启用'] })\r\n        return\r\n      }\r\n      if (rule?.disabled === false && micromatch.isMatch(filePath, ignoreRules)) {\r\n        disableRule(filePath)\r\n        global.sendLog({ message: `禁用了模板<span class=\"text-pink-500\">${filePath}</span>`, date: new Date().valueOf(), type: 'warning', tags: ['禁用'] })\r\n      }\r\n    })\r\n  }\r\n}","import Koa from 'koa';\r\nimport {getRuleByUrl} from '../file/index';\r\n\r\nexport default (server:any) => {\r\n  const app = new Koa();\r\n  app.proxy = true;\r\n  app.silent = true;\r\n  app.use((ctx) => {\r\n    const href = ctx.request.href\r\n    const rule = getRuleByUrl(href)\r\n    if(rule){\r\n      const sendStr = encodeURIComponent(rule.filePath)\r\n      ctx.body = `* monkey://${sendStr}`\r\n    } else {\r\n      ctx.body = `${href} ${href}`\r\n    }\r\n  })\r\n  server.on('request', app.callback());\r\n};\r\n","import { getValueByStatement } from '@zhangxin/mock-monkey-core';\r\n\r\nfunction isEqual(statement: string, val: any, scope: any) {\r\n  const result = getValueByStatement(statement, scope);\r\n  console.log(result, 're', statement);\r\n  if (typeof result === 'function') {\r\n    result(val);\r\n  }\r\n  return val === result;\r\n}\r\n\r\n// 根据多数接口调查，request body一般就一层结构，所以做个简单的，只遍历第一层的\r\nexport function isValid(\r\n  father: unknown,\r\n  child: unknown,\r\n  scope: unknown\r\n): boolean {\r\n  if (child == null) {\r\n    return true;\r\n  }\r\n  if (father == null) {\r\n    throw Error('入参不存在，但是却配置了入参验证, 所以请求失败');\r\n  }\r\n  Object.keys(child as { [key: string]: any }).forEach(key => {\r\n    const cv = (child as { [key: string]: any })[key];\r\n    const fv = (father as { [key: string]: any })[key];\r\n    const bo = isEqual(cv, fv, scope);\r\n    if (bo === false) {\r\n      throw Error(`入参字段 ${key} 不符合判定规则`);\r\n    }\r\n  });\r\n  return true\r\n}\r\n","import { getRule } from '../file/index';\r\nimport { generate } from '@zhangxin/mock-monkey-core';\r\nimport { Rule } from '../file/interface';\r\nimport http from 'http';\r\nimport { isValid } from '../utils/match';\r\n\r\ninterface Request {\r\n  originalReq: {\r\n    ruleValue: string;\r\n  };\r\n  passThrough: () => {};\r\n}\r\n\r\nconst NEXT = 'next';\r\n\r\nexport default (server: http.Server) => {\r\n  server.on(\r\n    'request',\r\n    (req: http.IncomingMessage & Request, res: http.OutgoingMessage) => {\r\n      const filePath = decodeURIComponent(req.originalReq.ruleValue);\r\n      const rule = getRule(filePath);\r\n      if (filePath) {\r\n        let data = '';\r\n        req.on('data', (chunk: any) => {\r\n          data += chunk.toString('utf-8');\r\n        });\r\n        req.on('end', () => {\r\n          if (!data) {\r\n            data = '{}';\r\n          }\r\n          try {\r\n            const url = new URL(req.url || '', `http://${req.headers.host}`);\r\n            const queryData: { [key: string]: any } = {};\r\n            url.searchParams.forEach((val, key) => {\r\n              queryData[key] = val;\r\n            });\r\n            const requestData = { ...JSON.parse(data), ...queryData };\r\n            queue(\r\n              [handleCors, handleRequestDataMatch, handleDelay, handleDefault],\r\n              [req, res, rule, requestData]\r\n            );\r\n          } catch (error) {\r\n            res.setHeader('Content-Type', 'text/plain');\r\n            res.end(error.message, 'utf-8');\r\n            console.log(error);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  );\r\n};\r\n\r\n// 延迟功能\r\nfunction handleDelay(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.OutgoingMessage,\r\n  rule: Rule,\r\n  requestData: any\r\n) {\r\n  if (typeof rule?.delay === 'number') {\r\n    const body = generate(rule?.response?.body, requestData);\r\n    const url = new URL(request.url || '', `http://${request.headers.host}`);\r\n    const filePath = decodeURIComponent(request.originalReq.ruleValue);\r\n    setTimeout(() => {\r\n      response.end(JSON.stringify(body), 'utf-8');\r\n      global.sendLog({\r\n        type: 'success',\r\n        message: `请求<span class=\"text-purple-500\">${url.pathname}\r\n          </span>延迟${rule.delay}ms, 命中文件<span class=\"text-pink-500\">${filePath}</span>`,\r\n        date: new Date().valueOf(),\r\n        tags: ['命中'],\r\n      });\r\n    }, rule.delay);\r\n    return;\r\n  }\r\n  return NEXT;\r\n}\r\n\r\n// 跨域设置\r\nfunction handleCors(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.OutgoingMessage\r\n) {\r\n  response.setHeader('Access-Control-Allow-Credentials', 'true');\r\n  response.setHeader(\r\n    'Access-Control-Allow-Origin',\r\n    request.headers['origin'] || ''\r\n  );\r\n  response.setHeader('Content-Type', 'application/json');\r\n  return NEXT;\r\n}\r\n\r\n// 对入参的验证。\r\nfunction handleRequestDataMatch(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.ServerResponse,\r\n  rule: Rule,\r\n  requestData: any\r\n) {\r\n  try {\r\n    isValid(requestData, rule?.request?.body, requestData);\r\n  } catch (error) {\r\n    response.statusCode = 400;\r\n    response.statusMessage = error.message;\r\n    response.end(\r\n      JSON.stringify({ code: 400, message: error.message }),\r\n      'utf-8'\r\n    );\r\n    const filePath = decodeURIComponent(request.originalReq.ruleValue);\r\n    const url = new URL(request.url || '', `http://${request.headers.host}`);\r\n    global.sendLog({\r\n      type: 'error',\r\n      message: `请求<span class=\"text-purple-500\">${url.pathname}</span>命中文件<span class=\"text-pink-500\">${filePath}</span>,但是参数有问题`,\r\n      date: new Date().valueOf(),\r\n      tags: ['命中','入参'],\r\n    });\r\n    return;\r\n  }\r\n  return NEXT;\r\n}\r\n// 兜底方案\r\nfunction handleDefault(\r\n  request: http.IncomingMessage & Request,\r\n  response: http.OutgoingMessage,\r\n  rule: Rule,\r\n  requestData: any\r\n) {\r\n  const filePath = decodeURIComponent(request.originalReq.ruleValue);\r\n  const body = generate(rule?.response?.body, requestData);\r\n  const url = new URL(request.url || '', `http://${request.headers.host}`);\r\n  response.end(JSON.stringify(body), 'utf-8');\r\n  global.sendLog({\r\n    type: 'success',\r\n    message: `请求<span class=\"text-purple-500\">${url.pathname}</span>命中文件<span class=\"text-pink-500\">${filePath}</span>`,\r\n    date: new Date().valueOf(),\r\n    tags: ['命中'],\r\n  });\r\n}\r\n\r\nfunction queue(items: Function[], params: unknown[]) {\r\n  let isBreak = false;\r\n  items.forEach(func => {\r\n    if (!isBreak) {\r\n      isBreak = func(...params) === NEXT ? false : true;\r\n    }\r\n  });\r\n}\r\n","import Koa from 'koa';\r\nimport Router from '@koa/router';\r\n// @ts-ignore\r\nimport cors from '@koa/cors';\r\nimport { watch } from '../file/index';\r\nimport body from 'koa-body';\r\nimport send from 'koa-send';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\n// @ts-ignore\r\nimport { Server } from 'ws';\r\nimport { Log } from '../interface/log';\r\n\r\nconst app = new Koa();\r\nconst router = new Router();\r\n\r\nrouter.post('/cgi-bin/root', async ctx => {\r\n  const body = ctx.request.body;\r\n  if (!body.path) {\r\n    ctx.response.status = 500;\r\n    ctx.response.message = 'do not find property \"path\"';\r\n    return;\r\n  }\r\n  try {\r\n    const config = JSON.parse(\r\n      fs.readFileSync('./config.json', { encoding: 'utf-8' })\r\n    );\r\n    config.root = body.path;\r\n    fs.writeFileSync('./config.json', JSON.stringify(config), {\r\n      encoding: 'utf-8',\r\n    });\r\n    await watch(body.path);\r\n    ctx.response.status = 200;\r\n    ctx.response.body = JSON.stringify({ path: body.path });\r\n  } catch (error) {\r\n    ctx.response.status = 500;\r\n    ctx.response.message = error.message;\r\n  }\r\n});\r\nrouter.get('/cgi-bin/root', async ctx => {\r\n  const { root } = JSON.parse(\r\n    fs.readFileSync('./config.json', { encoding: 'utf-8' })\r\n  );\r\n  ctx.response.status = 200;\r\n  ctx.response.body = JSON.stringify({ path: root });\r\n});\r\n\r\napp.proxy = true;\r\napp.silent = true;\r\napp\r\n  .use(body())\r\n  .use(cors({ credentials: true }))\r\n  .use(router.routes())\r\n  .use(router.allowedMethods())\r\n  .use(async ctx => {\r\n    const root = path.resolve(__dirname, '../public');\r\n    const parsedPath = path.parse(ctx.path);\r\n    if (ctx.path === '/plugin.monkey/') {\r\n      await send(ctx, './index.html', { root });\r\n      return;\r\n    }\r\n    if (parsedPath.ext !== '') {\r\n      const isExist = fs.existsSync(`${root}${ctx.path}`);\r\n      if (isExist) {\r\n        await send(ctx, `.${ctx.path}`, { root });\r\n        return;\r\n      }\r\n      ctx.response.status = 500;\r\n      ctx.response.message = 'file not found';\r\n      return;\r\n    }\r\n    await send(ctx, './index.html', { root });\r\n  });\r\n\r\nlet hasInit = false;\r\nexport default (server: any) => {\r\n  if (!fs.existsSync('./config.json')) {\r\n    fs.writeFileSync('./config.json', JSON.stringify({ root: '' }), {\r\n      encoding: 'utf-8',\r\n    });\r\n  }\r\n  server.on('request', app.callback());\r\n  const wss = new Server({ port: 9999 });\r\n  wss.on('connection', async function(_ws: any) {\r\n    global.sendLog = (log: Log) => {\r\n      _ws.send(JSON.stringify(log));\r\n    };\r\n    if (!hasInit) {\r\n      const { root } = JSON.parse(\r\n        fs.readFileSync('./config.json', { encoding: 'utf-8' })\r\n      );\r\n      if (root) {\r\n        try {\r\n          await watch(root);\r\n        } catch (error) {\r\n          sendLog({\r\n            type: 'error',\r\n            message: error.message,\r\n            date: new Date().valueOf(),\r\n            tags: ['路径'],\r\n          });\r\n        }\r\n        hasInit = true;\r\n      }\r\n    }\r\n  });\r\n};\r\n"],"names":["store","Map","addRule","key","rule","Error","set","deleteRule","delete","disableRule","tempRule","get","disabled","enableRule","getRule","getRuleByUrl","url","urlObj","URL","pathNames","pathname","values","find","includes","request","query","queryList","micromatch","keys","currentWatcher","watch","watchPath","close","fs","existsSync","chokidar","on","eventName","_path","queue","handleJSFile","handleYAMLFile","handleIgnore","replace","getObjFromYAML","filePath","content","readFileSync","encoding","YAML","parse","error","addFile","updateFile","deleteFile","funcs","params","func","getIgnoreRules","dir","root","ignoreFilePath","findup","cwd","ignoreRules","split","filter","text","startsWith","map","prefixPath","path","parsedPath","ext","i18n","add","change","unlinkDir","unlink","addDir","require","cache","mod","Object","forEach","addFunction","global","sendLog","message","date","Date","valueOf","type","tags","isMatch","_eventName","name","server","app","Koa","proxy","silent","use","ctx","href","sendStr","encodeURIComponent","body","callback","isEqual","statement","val","scope","result","getValueByStatement","console","log","isValid","father","child","cv","fv","bo","NEXT","req","res","decodeURIComponent","originalReq","ruleValue","data","chunk","toString","headers","host","queryData","searchParams","requestData","JSON","handleCors","handleRequestDataMatch","handleDelay","handleDefault","setHeader","end","response","delay","generate","setTimeout","stringify","statusCode","statusMessage","code","items","isBreak","router","Router","post","status","config","writeFileSync","cors","credentials","routes","allowedMethods","resolve","__dirname","send","isExist","hasInit","wss","Server","port","_ws"],"mappings":"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"}